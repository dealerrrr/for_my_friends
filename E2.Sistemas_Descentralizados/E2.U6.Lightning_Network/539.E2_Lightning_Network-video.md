---
title: Lightning Network | Alberto Mera
URL: https://app.web3mba.io/courses/take/especializacion-2-sistemas-descentralizados/lessons/41082125-6-lightning-network-alberto-mera
Tags/Keywords: #Especialidad 2 #Sistemas descentralizados #E2U6 #Lightning Network #Alberto Mera
lang: es-AR
---
# Lightning Network
![[539.E2_Lightning_Network.mp4]]
[Lightning Network](https://app.web3mba.io?wvideo=41qddtth6r)

¿Qué es Lightning Network? El protocolo Lightning Network es un protocolo ideado para mejorar la escalabilidad de Bitcoin. Siempre surge la cuestión de la escalabilidad. No obstante, la escalabilidad realmente es algo que es necesario, pero solo cuando lo es, no antes. Al final, se habla de que es necesario que el protocolo X, nuevamente Bitcoin, tenga que ser escalable. Bueno, pero tiene que ser escalable cuando realmente esto sea necesario. Hoy en día, enviar una transferencia a través de la red de Bitcoin puede costar entre medio euro y dos euros. Entonces, realmente, los bloques no están llenos, de modo que no es demasiado importante que se alcance una mayor escalabilidad. Al menos, no hoy. Claro, cuanto más va creciendo la red, más necesario es dicha escalabilidad. Pero, como digo, es algo que es necesario cuando lo es.

Lightning Network trabaja como una segunda capa sobre Bitcoin, una que permite a Bitcoin realizar cosas que normalmente no podría y, más específicamente, transacciones instantáneas y con muy bajas comisiones. El desarrollo de este protocolo comenzó con los trabajos de Joseph Poon y Thaddeus Dryja, pero en la actualidad son empresas como Blockstream, Lightning Labs, Async, entre otras, quienes impulsan su desarrollo. El white paper de este desarrollo se puede encontrar en un enlace en su página web. Para entender un poco el potencial de esta tecnología, debemos tener presente dos cosas. La primera es que Bitcoin se creó como una solución de dinero digital. La segunda es que ese objetivo es hoy en día imposible si observamos el estado actual de la red y cómo funciona el software de Bitcoin. La razón de esto es muy sencilla: Bitcoin tiene un problema para escalar. En la actualidad, Bitcoin solo puede procesar de 7 a 8 transacciones por segundo. Esta es una capacidad muy pequeña que no puede hacer frente a las soluciones fiat, como Visa o Mastercard. Por esta razón, se entendía necesario encontrar una nueva forma de realizar transacciones de forma rápida, que fuera sencilla de utilizar y compatible con Bitcoin sin hacer grandes modificaciones. La respuesta a estas necesidades y más fue Lightning Network, protocolo del cual aprenderemos un poco más a continuación.

¿Por qué se necesita mejorar esta escalabilidad o por qué se entiende que es necesaria? Si Bitcoin tiene una red tan poderosa y extensa, entonces, ¿por qué debe mejorar esta función? La respuesta corta es que al mejorar la escalabilidad, las transacciones se realizan de forma más rápida y con menos coste. Para explicar la respuesta de forma más extensa, hagamos este pequeño ejercicio. Imagina que hay una transacción en Bitcoin que realizas tú. En ese momento, la red Bitcoin tiene muy poco uso y el coste en comisiones de esa transacción es muy pequeño. Sin embargo, el coste de las comisiones puede aumentar debido a que el uso de la red aumente. Esto se debe a que se genera una cola o un exceso de transacciones en la mempool. Como comentaba, cuantas más transacciones intentan incluirse en el bloque, más se incrementa el coste de la transacción; más hay que pagar para entrar en dicho bloque. Es ahí cuando los mineros suelen priorizar las transacciones con mayor pago de comisiones para obtener así más ganancias. De esa manera, si deseas que una transacción sea procesada de forma rápida, entonces tendrás que pagar más en comisiones. Pero este último caso también nos indica que los costes de las comisiones aumentarán hasta el punto de no permitirnos hacer micropagos. Por ejemplo, enviar un dólar puede resultar más caro que un dólar, de modo que es una situación totalmente sin sentido que la mejora de escalabilidad podría solucionar. De ahí la necesidad de mejorar esta función o esta capacidad en Bitcoin, donde Lightning Network ofrece una solución perfecta para dicho problema, permitiendo operaciones con costes mínimos, gran velocidad y seguridad.

Habiendo dicho esto, es importante entender que el dinero, en general, funciona en capas. Aquí me refiero a capas. Incluso en el momento en que el oro era el dinero más usado, el oro estaba en la base y, para escalar el oro, la gente no iba con oro por ahí, sino que usaba certificados de oro, que era lo que movía el dinero papel; ese es el comienzo del dinero papel. Así teníamos en la base el oro y sobre él teníamos el dinero papel. Ahora, la idea sería tener Bitcoin en la base y, sobre la blockchain base de Bitcoin, tendríamos una capa como Lightning Network. Ahora, esto funciona de manera muy similar a los tesoros del banco central americano. Tendríamos tesoros en la base y, por encima de los tesoros, tendríamos dinero fiat.

En 2021, para que veamos un poco el contexto de la capacidad de escalabilidad supuesta de Bitcoin, en ese año Bitcoin movió 3 trillones de valor. Es decir, en la capa base, movió 3 trillones de valor, solo por debajo de Visa y Mastercard, creciendo a un ritmo mucho mayor que estas. O sea que, si bien se dice que Bitcoin debe ser más escalable, nos referimos aquí a la rapidez solamente, pues, en cuanto a valor movido, Bitcoin puede mover mucho más valor que soluciones muy escalables como pueden ser Visa y Mastercard. Y estos números así lo reflejan. De hecho, el problema muchas veces al hacer transferencias en otros sistemas en esa capa base se ve en ejemplos como el de una transferencia que está todavía pendiente de oro, que tiene que ir de Reino Unido a Austria, que se inició en 2015 y que aún no se ha completado. Así que esas transferencias en la base son complejas. Claramente, las transacciones en la base de Bitcoin solo tardan 10 minutos, no 7 años.

Hablemos un poco de la seguridad de Lightning Network. En cuanto a la seguridad, existe un paper publicado en 2019 que realiza un análisis bastante técnico sobre la robustez de este desarrollo. Sus autores, Aquelos Clagias y Orfeas Stefanos Tirofinitis, realizaron un exhaustivo examen sobre la seguridad de la red Lightning y su resultado fue un documento de 84 páginas que puedes consultar. Dentro de las conclusiones, se entendía que Lightning Network ofrece las suficientes garantías para evitar la pérdida de Bitcoin en dicha red y que la seguridad de la red es un gran beneficio. Al mismo tiempo, indica que el protocolo puede ser aceptado o adaptado a distintas redes que necesiten de sus capacidades. No obstante, tampoco nos quedamos en un paper; al final, la importancia de Lightning es que, como es un código abierto, mucha gente está desarrollando sobre él, lo que permite escalar con un riesgo muy bajo.

Hablemos un poco de las ventajas de Lightning, aunque ya hemos cubierto algunas de ellas. En primer lugar, Lightning ofrece una de las opciones más poderosas para mejorar la escalabilidad de Bitcoin. Lightning puede llevar a Bitcoin hasta niveles cercanos a un millón de transacciones por segundo, mucho más que lo que manejan sistemas de pago como Visa o Mastercard. En segundo lugar, ofrece altos niveles de seguridad y anonimato, siendo esta parte muy importante, y esto se debe a que las transacciones ocurren off-chain, es decir, fuera de la cadena, por lo que los pagos son prácticamente imposibles de rastrear. Además, Lightning es compatible con otros proyectos de criptomonedas como pueden ser Litecoin u otros. En cuarto lugar, Lightning es capaz de reducir enormemente el nivel de tráfico de transacciones dentro de la red Bitcoin, lo que permite que esa red funcione de manera más eficiente. Las transacciones usando Lightning Network se realizan de forma casi instantánea, lo que permite la realización de micropagos e incluso la automatización de los mismos. También existe la capacidad de realizar intercambios atómicos cross-chain, es decir, entre cadenas, y esto facilita que dos cadenas de bloques que usen esta función puedan intercambiar tokens sin necesidad de un intermediario, como podría ser una bolsa.

También hay, claro, desventajas. Una de las principales es que los pagos solo pueden realizarse a usuarios que estén conectados a un canal de pago. Esto quiere decir que el usuario debe estar activo y conectado al canal. Las transacciones de criptomonedas tradicionales no tienen esta limitación. Lightning es un protocolo que está en constante desarrollo y esto es importante tenerlo en cuenta. Prueba de ello es que sus creadores aún recomiendan no usar esta red para operaciones con altas sumas de dinero. Es un protocolo que también limita la liquidez del canal al total de criptomonedas que sostienen todas las partes. Esta es otra situación que atenta contra las operaciones de alto valor, pues lleva a los usuarios a dividir sus fondos para tener liquidez en la blockchain normal y en los canales Lightning.

¿Cómo funciona la Lightning Network? Para entender cómo funciona, lo mejor es desarrollar o desglosar paso a paso todo su proceso de funcionamiento. Por esta razón, te explicaremos con un sencillo ejercicio cómo se realiza este proceso junto a otros puntos de interés para despejar así todas tus dudas. En primer lugar, dentro de Lightning tendremos dos participantes que crearán una transacción inicial en la cadena de bloques, pongamos 20 dólares. De esos 20 dólares, 10 serán de Carmen, el participante número 1, y 10 de Aitor, el número 2. Este reparto podría ser distinto y puede variar dentro del canal que mencionamos anteriormente, por lo que Carmen podría tener 15 y Aitor 5. Al final, en este caso, serían 20. Lo que Lightning hace es tomar la tecnología tras los canales de pago y crear una red que los conforma utilizando smart contracts para asegurarse de que la red pueda funcionar de forma descentralizada. En este sentido, nos quedaría el siguiente desglose del proceso. Carmen abriría un canal de pago con Aitor, que a su vez tiene un canal con Laura, que a su vez tiene un canal abierto con David. Entonces, hablamos de estas cuatro partes participando en distintos canales de pago o Payment Channels. Carmen, como decíamos, quiere intercambiar activos con David, por lo que podrá enviar fondos a través de Aitor y Laura para que lleguen en última instancia a David, que es el receptor. Debido a la naturaleza de la Lightning Network, Carmen no tendría por qué confiar en Aitor y Laura dentro del proceso, ya que se usa la criptografía para asegurarse de que los fondos que recibirá David serán exactamente los mismos que ha mandado Carmen. Si no, se devolverán de forma automática a Carmen.

Ahora bien, nos quedamos con una serie de preguntas que son muy importantes y que debemos responder. ¿Cómo es posible confiar en este tercer paso? ¿Qué sucede con la disponibilidad? ¿Y cómo se combate el posible engaño? Bien, ¿cómo es posible confiar en ese paso 3? En realidad, Aitor y Laura actúan como nodos dentro de la red que podemos equiparar a los mineros de la red Bitcoin. Esto gracias a que ellos procesan de forma descentralizada todas las transacciones sin tener control de los fondos que ayudan a mover. Por esa razón, en ningún momento Aitor y Laura podrían robar los fondos de Carmen, ya que tan solo se recibirán los fondos a enviar si ya se ha realizado la transacción de salida al receptor final, que en este caso, como decíamos, es David.

¿Qué sucede con la disponibilidad? Como decíamos, si Aitor se desconecta, los fondos del canal no quedarían indefinidamente atrapados en él, sino que dentro del mecanismo de smart contract de Lightning, los usuarios pueden cerrar de forma unilateral los canales. De esta forma, si Aitor desapareciera, Carmen podría recuperar su dinero de nuevo gracias al atributo de tiempo añadido en el contrato. Cuando un canal se cierra, a la vez, tras haberse realizado un número indefinido de transacciones en él, los fondos finales de cada parte constarán en la blockchain en 10 minutos o en la blockchain base, o lo que tarden en aparecer en la red.

¿Cómo se combate entonces el engaño? Bueno, si Carmen enviara fondos de su dirección multifirma a David en la Lightning Network pero no cumple y lo que hace es emitir una transacción antigua en la blockchain para cerrar el canal en el estado en el que estaba antes de enviar la transacción a David, el propio software, en búsqueda de este tipo de acciones, hará que Carmen pierda todos sus fondos enviados a David. Esto se hace así como penalización a tal acción, por lo que todo aquel que intente transmitir una transacción antigua e inválida será penalizado. Gracias a esta red de canales persona a persona, es posible encontrar un patrón dentro de la red para poder transmitir transacciones fuera de la cadena de bloques. Todo ello sin perder la confianza de que posteriormente, y tras cerrarse el canal, constará dentro de la blockchain.

Como hemos visto a lo largo de la historia de la explicación de este ejemplo, la importancia es tener saldos en esos canales, pues si la transacción empieza en el lado A con Aitor, David, Carmen, Laura, da igual, y quiere enviar a otra persona que está al otro extremo del canal, lo que hará falta será ir pasando por diferentes canales que tendrán que tener suficiente saldo para poder irlo moviendo de un lado a otro, para que finalmente llegue al último receptor. Esto habla de la importancia de los saldos y de su mantenimiento; puede ocurrir que si se pasa mucho saldo de un extremo a otro, luego no haya suficiente saldo en el extremo inicial para poder permitir otro nuevo salto. Entonces hay que tratar de mover de nuevo ese saldo que está en un lado al principio del canal. Y para esto hay empresas que están surgiendo ya que gestionan el mantenimiento de estos canales.

Lightning ha crecido enormemente en los últimos meses; concretamente, 2021 también ha sido su año de mayor crecimiento, y esto gracias a que han surgido muchos más canales, permitiendo así que se produzcan estos pagos descentralizados sobre una segunda capa de Bitcoin de manera sencilla y con todas las características y ventajas que ofrece Lightning y que hemos visto. Cubramos el software o varios tipos de software usados para la Lightning Network. Empecemos con el LNP Node o LNP Node. LNP Node es un nuevo nodo de Lightning Network escrito en Rust. Es un conjunto de microservicios capaces de ejecutar tanto la red de Lightning, tal y como está definida en los estándares Bolt, como el Lightning generalizado, con nombre en código Bifrost, una refactorización completa de los protocolos de la red que soporta Taproot, firmas Schnorr, activos RGB y demás servicios como los DLCs, canales multipares, fábricas de canales, composibilidad de canales y muchas otras características tan avanzadas. El nodo LNP funciona con protocolos de red de Internet2 y una arquitectura de microservicios especialmente diseñada.

El ENP o Lightning Network Protocol es la unificación de la red Lightning normal o la heredada y de Bifrost, como decimos. Por su parte, Internet2 es un conjunto de buenas prácticas para utilizar los protocolos existentes en las comunicaciones de red, preservando la mayor parte de la privacidad y el anonimato. Soporta tanto operaciones peer-to-peer como RPC, que son entre cliente y servidor, y representa comunicaciones encriptadas para P2P y 0MQ, encriptado también para comunicaciones cliente-servidor. Esto permite evitar los escollos más comunes con las autoridades de certificación centralizada o los protocolos JSON, XML, RPC o de servicios web de baja eficiencia en texto plano. La capa peer-to-peer es un extracto de Bolt 8 y parcialmente de Bolt 1, ampliado para soportar mensajería arbitraria, RPC, peer-to-peer y APIs de publicación y suscripción sobre TCP-IP. Es 100% compatible con Lightning, pero permite mucho más que los usos actuales de Lightning. El protocolo se define como un conjunto de normas que son extensiones estrictas de Bolt. En otras palabras, con este protocolo se puede hacer una mensajería arbitraria y construir sistemas distribuidos complejos sin autoridad central, por lo que la asociación LNP-BP la utilizamos en todas partes, incluso para las comunicaciones internas de Lightning entre microservicios.

Bifrost es una forma de definir los canales de pago de forma modular y extensible, de manera que se puedan añadir fácilmente nuevas salidas de transacciones a las transacciones de compromiso, cambiar pagos, usar Taproot y hacer mucha experimentación sin inventar nuevos mensajes y estándares cada vez. Dentro de las funciones de LNP podemos describir unas pocas. Por ejemplo, ofrece la capacidad de crear nodos que permiten actualizar de forma segura el protocolo mediante la creación de microservicios y módulos que se pueden añadir al nodo con el fin de extender sus funcionalidades según sean requeridas. También permite la creación de protocolos sobre Lightning en una capa 3, como sería RGB o DLC. Está preparado para el móvil, para la nube, para la web, gracias a una arquitectura de microservicios especialmente diseñada. Permite la dockerización, ofrece soporte para 0MQ, añade soporte para implementar canales bidireccionales y otra serie de características que podéis analizar en más detalle.

Pasemos ahora a tratar Core Lightning o C-Lightning. Core Lightning es uno de los softwares para nodos de Lightning Network que ha estado en uso desde su producción en la red principal de Bitcoin desde principios de 2018 y que está en manos de Blockstream, una de las principales empresas del sector centrada en el desarrollo de Bitcoin. Escrito en el lenguaje de programación C, que ofrece a los desarrolladores un alto grado de control sobre el comportamiento de su código, incluso a bajo nivel, CLN tiene un enfoque en la eficiencia, así como en proporcionar a los desarrolladores y usuarios una implementación modular basada en plugins de protocolo de escalamiento en la capa 2 de Bitcoin. Core Lightning solo funciona en Linux y en Mac y requiere una versión local o remota de Bitcoin. El proceso de instalación de la versión local de Bitcoin es muy sencillo; solo se necesita un código de la versión local y el código de la versión local de Bitcoin es el mismo que el de la versión local. Superior, 0.16 o superior, es decir, necesita un nodo de Bitcoin Core instalado, como os comenté antes, y que esté completamente al día con la red en la que el usuario está ejecutando y retransmitiendo las transacciones. Al ser una implementación ligera, CLN permite un gran nivel de personalización, ya que ofrece al usuario hacer lo suyo y añadir solo las características que quiera o necesite. La modularidad, la eficiencia y la solidez del código de CLN también tienen sus inconvenientes, por otra parte. De hecho, sus desarrolladores se han ceñido mucho a la filosofía llamada KISS, Keep it simple, stupid, y UNIX, Do one thing and keep it right. De allí que el protocolo sea extremadamente sencillo y robusto, lo que agrega una gran capa de seguridad y permite la construcción de aplicaciones sobre el mismo para que puedan disfrutar de dichas habilidades. Si bien en seguridad y utilidad C-Lightning es excelente, a nivel de uso para usuarios nóveles puede ser todo un reto. Sin embargo, la implementación de Blockstream se centra en gran medida en el proceso de especificación y genera gran parte de su código a partir de las especificaciones Bolt directamente. Si bien esto garantiza una implementación totalmente compatible con las especificaciones, el equipo dispone de menos tiempo para comercializar su trabajo e identifica esto como la razón por la que ve menos participación de la comunidad en este sistema que en otros. Por otro lado, dada su eficiencia y ligereza, CLN es probablemente la implementación más adecuada para los dispositivos de baja especificación. El equipo de Blockstream también ha desarrollado un conjunto de nuevas características que amplían la funcionalidad actual de Volt, que como hemos dicho es lo que usan, y que suelen ser borradores de especificaciones o propuestas de especificaciones como la apertura de canales colaborativos, los anuncios de liquidez y Volt 12. CLN ofrece al usuario la posibilidad de probar estas próximas especificaciones. Por ejemplo, la apertura de canales colaborativos, antes llamados canales de financiación dual, permite a los participantes abrir un nuevo canal de forma colaborativa, financiando conjuntamente la transacción de financiación del canal. Actualmente, los canales se abren con una transacción de financiación unilateral, es decir, por una persona, pero estos canales permitirían hacerlo en colaboración y también al mismo tiempo permitirían hacer coin joins. Los Coin Joins, como sabemos, permiten dificultar la trazabilidad de las monedas. También se puede hacer uso de los anuncios de liquidez que aprovechan la apertura de canales de colaboración. Según una entrada del blog de Blockstream, son una forma ligera de proporcionar la capacidad de coordinar el despliegue de liquidez en toda la red, de forma descentralizada y accesible. Esta es una característica que intenta resolver un problema común en Lightning, que es la liquidez entrante.

Por otra parte, tenemos la Lightning Network Daemon, o sea, tenemos aquí la LND, una implementación completa de un nodo de la red Lightning. LND tiene varios servicios de cadena backend enchufables, incluyendo BTCD, un nodo completo, Bitcoin NDI y Neutrino, un nuevo cliente ligero experimental. El código base del proyecto utiliza el conjunto BTC Suite de bibliotecas Bitcoin y también exporta un gran conjunto de bibliotecas aisladas reutilizables relacionadas con la red Lightning dentro de ella. En el estado actual, el LND es capaz de hacer una serie de cosas como crear canales, cerrar canales, gestionar completamente todos los estados de los canales, realizar la búsqueda de rutas dentro de la red, reenviando pasivamente los pagos entrantes. También permite cosas como el envío de pagos salientes encriptados, actualizar las tarifas dentro de los canales. En general, un montón de cosas, una serie de capacidades que permiten la mayor facilidad en la gestión de dichos canales, que como hemos dicho siempre es uno de los principales escollos a la hora de gestionar tu propio canal de Lightning.

Bien, entonces, como hemos visto, hay diferentes softwares que tratan de solucionar o de facilitar la tarea de manejar un canal en Lightning y de usar esta segunda capa de Bitcoin, cuyo objetivo es, como hemos dicho, permitir una mayor escalabilidad. Al final, me remito a lo dicho al principio, y es que la escalabilidad es algo que se trabajará. En función de la necesidad del usuario de usar dicha escalabilidad, se irán dedicando más recursos por parte del mundo entero en mejorar. Y como hemos visto, ya hay varias implementaciones que usan distintos sistemas para permitir esto, y en los siguientes años lo único que nos queda esperar es que estas soluciones se vayan incluso mejorando y permitiendo su uso de manera aún más sencilla para los usuarios. Así que es un sector a tener en cuenta y esperar que vaya mejorando.