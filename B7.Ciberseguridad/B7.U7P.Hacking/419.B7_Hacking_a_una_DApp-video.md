---
title: Hacking a una DApp | Pablo Vilavalle
URL: https://app.web3mba.io/courses/take/bloque-7-ciberseguridad/lessons/40011665-practica-hacking-a-una-dapp-pablo-vilavalle
Tags/Keywords: #Bloque 7 #Ciberseguridad #B7U7 #practica #Hacking a una DApp #hacking #Pablo Vilavalle
lang: es-AR
---
# Hacking a una DApp
![[419.B7_Hacking_a_una_DApp.mp4]]
[Hacking un DApp](https://app.web3mba.io?wvideo=4zmgcs89nz)

Mi nombre es Pablo y en este vídeo os voy a demostrar cómo un atacante, aprovechándose de una vulnerabilidad en la parte del cliente de un DEX, es decir, de un exchange descentralizado, podría hacer que la víctima, en lugar de realizar un simple swap de un token a otro, como se suele hacer en este tipo de aplicaciones, transfiera todos los fondos de su billetera a la billetera del atacante.

Para ver cómo funciona este tipo de vulnerabilidad y qué tendría que hacer el atacante para explotarla, hemos preparado un pequeño ejemplo. Supongamos que un DEX tiene un sistema de referidos en el que se aplica un 0,5% de descuento en cualquier tipo de swap a aquellas personas que compartan el enlace de referidos con diferentes usuarios. Cada usuario tiene asignado un código de referido que se imprime en la página web junto a un mensaje que indica que tienen un descuento. Este código de referido se obtiene de los parámetros de la URL.

El problema aquí es que un atacante podría enviar esa URL, pero en la variable "referer" incluir un script que podría ejecutar lo que desee. Al introducir un script, cuando se añada el HTML para imprimir esto en pantalla, no se añadirá una simple variable como es el código de referido, sino que se ejecutará el script que haya introducido el atacante.

Para que veáis un poco el entorno que hemos preparado, nosotros hemos montado un DEX de pruebas para que podáis observar cómo funciona. Si un usuario quisiera entrar a esta página y hacer un swap de un token a otro, lo primero que tendría que hacer es desbloquear su billetera. Nosotros hemos creado una billetera de Metamask de prueba. Entonces, conectamos. Hasta aquí no pasaría nada; simplemente, lo que quiere el exchange es poder ver tus direcciones.

Una vez que nos hayamos conectado con nuestra billetera, lo que podría hacer un usuario aquí sería, por ejemplo, intercambiar algún token por otro diferente. Imaginemos que el usuario introduce un token. Lo que estaríamos haciendo es tomar de nuestros fondos un USDT e intercambiarlo por su equivalente en BUSD. Si pulsamos en "swap", lo primero que nos va a pedir el exchange es que le otorguemos permisos para acceder a nuestros fondos y poder intercambiar cualquier cantidad de nuestro USDT a BUSD. Antes de nada, tenemos que confirmar esto.

Una vez que hemos confirmado que el exchange puede acceder a nuestros fondos, también nos pedirá que confirmemos la transacción. Debemos entender que esto es una interacción con un contrato, en este caso, con el contrato de PancakeSwap, que permite cambiar de un token a otro. Confirmamos la transacción y, como vemos aquí, se nos ha descontado la cantidad que hemos indicado de USDT. Antes estaba a 27 porque hice unas pruebas antes de grabar esto, así que ahora tenemos 2 menos. Si nos dirigimos aquí, vemos que hemos interactuado con esta dirección, que es la dirección de un contrato. Si la abrimos en el explorador de bloques, en Etherscan, veremos que hemos interactuado con este contrato.

Si observamos la función que se ha ejecutado, es "swapExactTokensForTokens", es decir, está cambiando una cantidad exacta de tokens por otra cantidad de tokens. Si abrimos este contrato, podemos ver que es el contrato oficial de PancakeSwap que se utiliza en su DEX para intercambiar tokens. Hasta aquí todo correcto, no hay nada raro, todo funciona perfectamente.

Ahora vamos a ver qué pasaría si el atacante nos enviara una dirección con este sistema de referidos del que estábamos hablando antes. El atacante lo único que tendría que hacer es pasarle a la víctima esta URL, que como veis es un poco diferente a la URL que había antes. Aquí, el atacante se está aprovechando de que la variable "referer" se inyecta en el código HTML de la página del cliente, de manera que le está pasando un script. Este script lo que hace es cambiar la dirección del contrato del router de PancakeSwap.

Es decir, el contrato de PancakeSwap interactúa con nuestra billetera para poder hacer el intercambio de tokens, pero lo que está haciendo el atacante es cambiarlo por un contrato que, como podemos suponer, es malicioso. Ahora veremos qué código tiene. Entonces, el usuario vendría aquí y haría lo mismo que antes: cambiar USDT por BUSD. Como veis, aquí ya aparecería el código diciéndonos que estamos en una línea de referidos y que se nos aplica un 0,5% de descuento en cualquier tipo de swap.

Vamos a hacer el cambio, pinchamos y ahora se nos abre esta ventana. Esta ventana, como veis, nos dice el mismo mensaje que antes, es decir, le estamos dando acceso al exchange a todos nuestros fondos, pero si nos fijamos, esta dirección no es la misma que antes; es la dirección que nos ha inyectado el atacante mediante este script. Vamos a ver lo que pasaría. Confirmamos y ahora tenemos que esperar. Se nos abriría otra ventana confirmando nuestra transacción, es decir, confirmando el swap entre estos dos tokens.

Ya tenemos por aquí. En principio, no hay nada raro. En ningún sitio pone que se te vaya a quitar toda la cantidad de tokens que tienes en tu billetera. Simplemente indica que vas a hacer una interacción con un contrato, igual que lo haces con el contrato de PancakeSwap. Si confirmamos la transacción... Ahora aquí, en algún momento, si... porque esta transacción tarda un poco, igual que la de antes, vemos que tenemos cero USDT, es decir, nos han vaciado la cuenta simplemente haciendo lo mismo que hacíamos con el exchange, pero sin la URL y sin el script inyectado.

Vamos a irnos a la dirección que tengo preparada, que es donde he enviado los fondos, y efectivamente aquí están los 25 USDT. Como vemos, esto lo veríamos en la cuenta de aquí. Vamos a ver qué ha pasado. Bien, aquí lo que ha sucedido es que hemos interactuado con este contrato ejecutando esta función, que realmente tiene el mismo nombre que la función del contrato de PancakeSwap, pero vamos a ver qué hace esta función del contrato malicioso.

Lo primero que tenemos que fijarnos es que a este contrato, al desplegarse, se le asigna un "receiver", que será la misma cuenta que haya desplegado este contrato. Luego, este contrato lo hemos escrito nosotros, así que para facilitarnos las pruebas y asignar una billetera de atacante donde irán todos los fondos de la víctima, hemos creado esta función "setReceiver", que permite cambiar la dirección de la cuenta que recibirá todos los fondos. Obviamente, esta función no tendría sentido que un atacante la escribiera, porque permitiría a cualquier persona cambiar la billetera donde irán todos los fondos del ataque.

Lo que sí nos interesa de verdad es esta función, "swapExactTokensForTokens", que es la misma función que tenía el contrato original de PancakeSwap, pero en este caso lo que hace es tomar el balance de todos los tokens de la cuenta de esta dirección, que es la cuenta que interactúa con este contrato, es decir, nuestra billetera víctima, y transferir todo su balance al "receiver", que recordemos que es el atacante, es decir, la persona que despliega este contrato. Por lo tanto, solo con estas dos líneas ya estaríamos enviando todo el balance de esta cuenta a la cuenta del atacante, que como vemos aquí, se ha llevado todo el balance, todo el USDT de la cuenta de la víctima.

Hemos visto cómo un atacante, aprovechando una vulnerabilidad de XSS, ha podido robar todos los balances de una cuenta de la víctima. Lo que quiero que se entienda con este vídeo es que no todo en el mundo de Web3, en cuanto a seguridad, tiene que ver con los smart contracts y la blockchain. Un DeFi, un DEX, cualquier aplicación en Web3, tiene que tener un enfoque de seguridad. Al fin y al cabo, tiene una parte de cliente y una parte de servidor, además de interactuar con la blockchain e interactuar con smart contracts.

Debemos tener en cuenta que este cliente y este servidor pueden tener vulnerabilidades, igual que cualquier otra página web o aplicación. Por lo tanto, esto es importante porque, al desarrollar este tipo de aplicaciones, no solo hay que considerar la seguridad de los smart contracts, que también tienen vulnerabilidades, incluso estando desplegados en la blockchain, sino que también debemos hacer hincapié en la seguridad de las aplicaciones, tanto en la parte del cliente como en la parte del servidor.

Por ejemplo, en este caso, una vulnerabilidad de este tipo, un XSS, podría afectar mucho más a un cliente en una aplicación Web3 que en una aplicación Web2, por el simple hecho de que los usuarios están interactuando con sus billeteras dentro de nuestra aplicación, y sus billeteras solo contienen dinero. Para finalizar, quiero que reflexionéis un poco sobre lo que os acabo de comentar y que tengáis siempre presente la seguridad de las aplicaciones, y que blockchain no implica seguridad. Siguen existiendo vulnerabilidades tanto en Web3 como en smart contracts. Espero que os haya gustado el vídeo y que os haya servido de ejemplo para entender lo que os acabo de explicar. Un saludo.