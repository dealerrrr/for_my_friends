---
title: Gestión Avanzada de Seguridad | Washington Gómez
URL: https://app.web3mba.io/courses/take/bloque-7-electiva-1-gestion-avanzada-de-seguridad-en-windows-y-linux/lessons/40125930-e1-gestion-avanzada-de-seguridad-washington-gomez
Tags/Keywords: null
---

### 425.B7E1_Gestión_Avanzada_de_Seguridad-video

### Gestión Avanzada de Seguridad
![[425.B7E1_Gestión_Avanzada_de_Seguridad.mp4]]
[Gestion Avanzada de Seguridad](https://app.web3mba.io?wvideo=wbef19sbmp)

Lo que se siente delictivo sobre el delito de violencia tiene distintos cometidos. Por ejemplo, podemos destacar las normas ISO, que permiten, a través de la certificación, validar que tenemos un sistema de gestión de seguridad de la información, así como una correcta gestión de los riesgos, de nuestra gobernanza y de todo lo que se refiere a políticas, procedimientos y planes, para garantizar así una adecuada gestión de la seguridad de la información.

Así como tenemos las normas ISO, también han aparecido otros tipos de normativas y frameworks de ciberseguridad que cumplen el objetivo de demostrar de forma fehaciente, a través de una certificación, que la empresa está madura en la gestión de la ciberseguridad y en la gestión de los procesos que hacen a la seguridad de la información. Para esto, ¿cómo se desarrollan y logran estas certificaciones? Bueno, estas certificaciones se obtienen pasando por un proceso de auditoría.

¿Qué es un proceso de auditoría o cómo se concibe una auditoría? Una auditoría puede tener distintos enfoques. El enfoque principal de una auditoría es validar, frente a un conjunto de requisitos, que generalmente están dados por una norma, cuál es el grado de madurez que tiene la empresa en relación con esos requisitos. A modo de ejemplo, podemos mencionar la norma ISO 27001 y PCI DSS, que es la normativa que nos permite gestionar y transaccionar con datos de tarjetas de crédito. Estas normativas tienen distintas formas de validarse, pero ambas comparten algo en común: se llevan a cabo a través de auditores.

En el caso de PCI DSS, los auditores son llamados QSI o QSR, y en el caso de ISO 27001, se les denomina auditores de seguridad. La función de ambos es exactamente la misma: a partir de los requerimientos de una norma, validar si la empresa realmente está cumpliendo con cada uno de los requisitos con el fin de garantizar la seguridad de la información. Las auditorías suelen ser anuales, tanto en el caso de ISO 27001 como de PCI DSS, pero también suelen ser externas. Es decir, generalmente uno no puede auditarse a sí mismo, sino que tiene que contratar una empresa totalmente independiente, que no puede ser la misma que haya asesorado a la empresa antes de la auditoría.

Esto es importante para las organizaciones al momento de decidir trabajar con un proveedor. Es fundamental validar que la empresa sea independiente y que tenga todos los mecanismos de seguridad para poder confiar en nuestra información e incluso en nuestros servicios. Para esto, es muy importante que las empresas puedan demostrar el grado de compromiso que tienen con la seguridad. La forma de hacer esto es certificándose en varias normas de seguridad, lo que les permite, a través de las mismas, demostrar su compromiso con la seguridad de la información y con las buenas prácticas que llevan a una correcta gestión de la información.

Es por esto que es importante el papel del auditor en este tipo de empresas y en este tipo de situaciones. Es esencial que el auditor sea una persona independiente que pueda gestionar durante todo el ciclo de la auditoría, desde la reunión de inicio hasta la reunión de cierre, todos los requisitos, para validar exactamente que la empresa esté cumpliendo con todos los requisitos que exige la auditoría y que también esté cumpliendo con todos los requisitos legales que, a veces, también nos establecen distintas certificaciones o reconocimientos cuando trabajamos, por ejemplo, con entes estatales o con entes públicos.

Para contratar una empresa o un proveedor, es muy importante que el proveedor o la empresa cuente con certificaciones en seguridad de la información. Esto nos permite tener cierto grado de tranquilidad al momento de trabajar con ese proveedor, porque sabemos que ha pasado por un proceso de certificación, ha sido auditado y nos da la confianza de que, al obtener la certificación, esa empresa ha cumplido de forma satisfactoria con todos los requisitos que la normativa exige. Por lo tanto, es una garantía poder trabajar siempre con empresas que estén certificadas y que cuenten con certificación en seguridad de la información, porque de esta forma nos aseguramos de que esa empresa podrá gestionar de forma adecuada nuestra información y podrá trabajar con los datos que nosotros les brindemos, teniendo siempre en cuenta y siendo consciente de lo que requiere la protección de esos datos.

Esto es importante destacar porque muchas empresas, a veces, frente a dos proveedores que ofrecen lo mismo, siempre la recomendación es optar por el proveedor que tenga alguna certificación o el que más certificaciones tenga en el ámbito de la ciberseguridad. Principalmente si se trata de un proveedor que va a gestionar nuestros datos personales o información sensible que le vamos a compartir de nuestra organización.

¿En qué nos ayudan las auditorías? Las auditorías nos ayudan a mejorar. Generalmente, las auditorías son puntos de control en la organización que, con una mirada externa de un auditor, nos permiten identificar nuestras debilidades a nivel de procesos y procedimientos, y de esta forma poder mejorar, en pro de optimizar también los procesos, la documentación y la calidad de la seguridad de la información.

Las auditorías tienen etapas bien definidas. Hay una etapa que se llama el inicio de la auditoría, que es cuando se realiza la reunión inicial, en la cual se busca explicar la metodología que se va a utilizar por parte del auditor, generar conciencia sobre quiénes deberían estar presentes durante esos días de auditoría y también presentar el roadmap a seguir.

El paso siguiente, que se suele realizar en todas las auditorías, es una revisión documental en la cual se envía información a la empresa que nos está auditando. Esta empresa hace una revisión exhaustiva de todos los documentos que les compartimos y, con esta información, se lleva a cabo la tercera etapa de la auditoría, que es la auditoría presencial, donde se auditan todos los procesos que ya han sido leídos y de los cuales se tiene información sobre cómo estamos operando dentro de la organización.

Por último, se realiza una reunión de cierre, en la cual se presentan algunos hallazgos o no conformidades de la auditoría y el nivel de criticidad de estos hallazgos o no conformidades. Muchas veces, una vez que se cierra la auditoría, se vuelve a programar una revisión, dando un espacio de tiempo de entre 15 y 20 días, en el cual se vuelve a realizar la auditoría sobre los hallazgos que se han encontrado para ver si, en ese lapso de tiempo, la empresa pudo cambiar y corregir esas malas prácticas o mejorar algún procedimiento o proceso que no estaba del todo bien o que no tenía el nivel de detalle que pudiera garantizar al auditor que se estaban realizando de forma segura.

Una vez que el proceso de QA interno de la empresa auditora finaliza, se lleva a cabo lo que se llama una reunión final con el cliente, en la cual se le dan los resultados, que en este caso sería que todo el proceso de auditoría fue positivo y que la empresa va a adquirir la certificación correspondiente. Este tipo de auditorías son muy importantes porque, como comentaba anteriormente, permiten validar la madurez y los procesos internos de las organizaciones en temas de seguridad de la información.


### 426.B7E1.1_Auditoría_de_Sistemas

### Auditoría de Sistemas
La auditoría de sistemas supone la revisión y evaluación de los controles y sistemas de informática, así como su utilización, eficiencia y seguridad en la empresa, la cual procesa la información.

Gracias a la Auditoría de Sistemas como alternativa de control, seguimiento y revisión, el proceso informático y las tecnologías se emplean de manera más eficiente y segura, garantizando una adecuada toma de decisiones.

La Auditoría de Sistemas consiste en:
1. La verificación de controles en el procesamiento de la información e instalación de sistemas, con el objetivo de evaluar su efectividad y presentar también alguna recomendación y consejo.
2. Verificar y juzgar de manera objetiva la información.
3. Examen y evaluación de los procesos en cuanto a informatización y trato de datos se refiere. Además, se evalúa la cantidad de recursos invertidos, la rentabilidad de cada proceso y su eficacia y eficiencia.
4. El análisis y evaluación realizados a través de la auditoría de sistemas debe ser objetivo, crítico, sistemático e imparcial. El informe de auditoría final deberá ser un claro ejemplo de la realidad de la empresa en cuanto a los procesos y la informatización se refiere, para tomar mejores decisiones y mejorar en el negocio.

#### Objetivos de la auditoría de sistemas
La presencia de la tecnología cada vez en más ámbitos empresariales, hace necesario un sistema de control, seguimiento y análisis, tal como la auditoría de sistemas.

- En primer lugar, se precisa garantizar la seguridad a la hora de tratar los datos, dotándolos de privacidad y buen uso. 
- En segundo lugar, para hacer del sistema informático, un proceso mucho más eficiente y rentable, permitiendo detectar errores y tomando decisiones de manera inmediata.

Así, podemos decir que los objetivos de la auditoría de sistemas son:
1. Mejorar la relación coste-beneficio de los sistemas de información.
2. Incrementar la satisfacción y seguridad de los usuarios de dichos sistemas informatizados.
3. Garantizar la confidencialidad e integridad a través de sistemas de seguridad y control profesionales.  
    Minimizar la existencia de riesgos, tales como virus o hackers, por ejemplo.
4. Optimizar y agilizar la toma de decisiones.
5. Educar sobre el control de los sistemas de información, puesto que se trata de un sector muy cambiante y relativamente nuevo, por lo que es preciso educar a los usuarios de estos procesos informatizados.

Por tanto, la auditoría de sistemas es un modo de control y evaluación no solo de los equipos informáticos en sí. Su ámbito de actuación gira también en torno al control de los sistemas de entrada a dichos equipos (claves y códigos de acceso), archivos y seguridad de los mismos, etc. 

> La auditoría de sistemas es fundamental para garantizar el desempeño y seguridad de los sistemas informáticos de una empresa, que sean confiables a la hora de usarlos y garanticen la máxima privacidad posible.


### 427.B7E1.1_Auditoría_de_Sistemas-Tipos_de_Auditoría

### Tipos de Auditoria
Entre los tipos de auditoria que existen podemos mencionar:
1. Auditoría en sistemas
2. Auditoría Informática
3. Auditoría de Información
4. Auditoría en Sistemas de Información

#### 1 | Auditoría en Sistemas
Es la rama que se encarga de llevar a cabo la evaluación de normas, controles, técnicas y procedimientos que se tienen establecidos en una empresa para lograr confiabilidad, oportunidad, seguridad y confidencialidad de la información que se procesa a través de los sistemas de información. 

La auditoría de sistemas es una rama especializada de la auditoría que promueve y aplica conceptos de auditoría en el área de sistemas de información.

##### Objetivos de la Auditoría en Sistemas
1. Mejor relación costo – beneficio de los sistemas automáticos diseñados e implementados por el área de Procesamiento de datos.
2. Incrementa la satisfacción de los usuarios de los Sistemas computarizados.
3. Asegura una mayor Integridad, Confidencialidad y Confiabilidad (La Tríada de la Ciberseguridad) de la información mediante la recomendación de seguridad y control.
4. Conocer la situación actual del área informática y las actividades, esfuerzos necesarios para lograr los objetivos propuestos.
5. Brindar seguridad al personal, Datos, Hardware, Software e instalaciones.
6. Minimizar existencia de riesgo usando la tecnología de información.
7. Decisiones de inversión, evitar gastos innecesarios.
8. Capacitación y educación sobre controles en los sistemas informáticos.

#### 2 | Auditoría Informática
La auditoría en informática es la revisión y la evaluación de los controles, sistemas, procedimientos de informática; de los equipos de cómputo, su utilización, eficiencia y seguridad, de la organización que participan en el procesamiento de la información, a fin de que por medio del señalamiento de cursos alternativos se logre una utilización más eficiente y segura de la información que servirá para una adecuada toma de decisiones.

##### Características de la auditoría informática
Al ser una modalidad de auditoría concerniente a un ámbito tan específico, cuenta con una serie de características propias respecto a otros tipos de mediciones o análisis:
1. Los profesionales auditores no solamente deben tener capacitación para la realización de trabajos de auditoría, sino que también formación específica relacionada con un contexto tecnológico o informático. Una correcta auditoría de este tipo debe servir para mostrar una imagen fiel sobre la adaptación al entorno digital y tecnológica de una compañía.
2. La evaluación no solamente requiere de estudio de los activos informáticos físicos de una compañía, sino que debe ir más allá abarcando la práctica y el uso de las plantillas. Los trabajadores deben estar cualificados y preparados para el máximo aprovechamiento de estas herramientas.
3. Debe existir un constante seguimiento a las actualizaciones informáticas del mercado y su aplicación empresarial.

Es importante destacar que, con la proliferación de nuevas metodologías y aplicaciones tecnológicas en la empresa, los informes de auditoría de tipo informático son cada vez más frecuentemente requeridos.  

##### Evolución de la auditoría informática
Debido al potencial crecimiento tecnológico experimentado en las últimas décadas y la rápida expansión de la red en prácticamente la totalidad de los negocios, la vigilancia de los sistemas informáticos empleados resulta inevitable. Gracias a la globalización existe cada vez una mayor adaptación por parte de empresas a estándares de software comunes. Esto ocurre, por ejemplo, en el ámbito de la ofimática.

#### 3 | Auditoría de Información
La auditoría de la información es una rama especializada de la auditoría que promueve y aplica conceptos de auditoría en el área de sistemas de información. 

El objetivo final que tiene el auditor es dar recomendaciones a la alta gerencia para mejorar o lograr un adecuado control interno en ambientes de tecnología informática con el fin de lograr mayor eficiencia operacional y administrativa.

La naturaleza especializada de la auditoría de los Sistemas de Información y las habilidades necesarias para llevar a cabo este tipo de auditorías, requieren el desarrollo y la promulgación de normas generales para la auditoría de los Sistemas de Información.

##### Objetivos de la Auditoría de la Información
El objetivo es asegurar que la información que circulará por el sistema sea la más apropiada para la organización. Mediante la Auditoría de la Información se pretende que la organización solamente reciba aquella información que sea relevante para sus intereses, reduciendo de esta manera el silencio (no obtención de información relevante) y el ruido (obtención de información no relevante) y los requerimientos de información de la organización (o sea, de la información que precisa para poder funcionar correctamente).

1. Identificar recursos de información (RI) dentro de la organización.
2. Identificar requerimientos de información de la organización.
3. Identificar, crear y ajustar los flujos y procesos, donde se maneja la información de la organización.
4. Identificar costes, beneficios y oportunidades de los RI.
5. Integrar los RI con los objetivos de la organización.
6. Evaluar la conformidad con las normativas existentes sobre información y su uso.

Todo esto con el fin de:
1. **Duplicidades:** Dentro de una misma organización en ocasiones se crea y almacena la misma información de manera independiente.
2. **Carencias:** No compartir información produce vacíos que atentan contra el correcto funcionamiento de determinadas unidades de negocio dentro de la organización.
3. **Inconsistencias:** Mantener la misma información de modo independiente puede dar lugar a informaciones contradictorias.

##### Metodología
En la actualidad no existe una metodología estándar para realizar una auditoría de información, sin embargo, se pueden desarrollar una serie de actividades y técnicas que pueden ayudar a realizarlas:
1. **Inventario físico:**  
    Es el proceso de identificación y categorización de los recursos de información de una forma sistemática. De esta forma, se proporciona una fotografía de lo que la organización posee en términos de recursos de información en un momento determinado.
2. **Mapificación de la información (Infomap):**   
    Constituye una forma gráfica de representar los recursos de información que hay en la organización y las interrelaciones entre estos. El mapa de recursos indica hasta qué punto los recursos de información son básicos, de qué modo se encuentran posicionados (geográficamente, departamentalmente, desde un punto de vista técnico), cómo interactúan, quién los utiliza, quién es el responsable, etc.
3. **Análisis de las necesidades de información:**  
    Tiene como finalidad principal determinar qué información requieren los empleados y la dirección de la organización para desarrollar sus papeles y alcanzar los objetivos.
4. **Gráficos de procesos y flujos de trabajo:**  
    Los gráficos de procesos junto con los flujos de trabajo pueden constituir una buena herramienta de trabajo en el ámbito de las auditorías de la información.
5. **Procesos de control y verificación:**  
    En una auditoría de la información, se deben establecer también los procesos de control y verificación.

El resultado de estos procesos puede consistir en un informe o incluso, un certificado que confirme que todo es correcto o que incluya recomendaciones de mejora. Hay que tener presente que el mapa de recursos de información, o mapa documental, puede constituir uno de los principales resultados del proceso de la auditoría de información.

En el caso del mapa documental, este detalla qué documentos se encuentran dentro de la organización, a qué tipo de funciones se encuentran vinculados y dan respuesta, quién tiene la responsabilidad y el acceso a esos documentos, en qué soporte están disponibles, dónde y cómo se encuentran accesibles y qué relación o nivel de integración tienen con el resto de los sistemas de información de la organización. También se establece la localización de todos los documentos dentro de los estándares y los procedimientos de la organización, así como su valor para el conocimiento corporativo.

#### 4 | Auditoría en Sistemas de Información
La auditoría de los sistemas de información se define como cualquier auditoría que abarca la revisión y evaluación de todos los aspectos (o de cualquier porción de ellos) de los sistemas automáticos de procesamiento de la   información, incluidos los procedimientos no automáticos relacionados con ellos y las interfaces correspondientes.

En general una auditoría de sistemas de información incluye todo el ciclo de vida de la tecnología e información que está bajo investigación. Quien esté interesado en llevar a cabo una auditoría puede ser el dueño de unos activos, un agente regulador, los administradores del sistema o cualquiera otro que esté interesado en la operación del entorno del sistema.

##### Objetivo de la Auditoría en Sistemas de Información
Los objetivos de la auditoría también pueden ser distintos. Por ejemplo, puede buscar evaluar la integridad operativa o confirmar que los datos privados de clientes de un banco no estén expuestos a personas no autorizadas.

En realidad, el alcance va a depender del objetivo que persiga la auditoría.

Lo importante es que el alcance de la auditoría debe estar definido desde el inicio, así como también, las personas, los recursos, los procesos y la tecnología necesaria para cumplir el objetivo propuesto. Si alguno de estos falla, es muy probable que se generen errores en el proceso, en consecuencia se pierden recursos y tiempo.

Cuando el alcance se define, las organizaciones hacen un enlace entre el auditor y el representante de seguridad de la información. Este último es el encargado de detallar la información que necesita el auditor sobre los sistemas, los manuales de los sistemas, los diagramas de arquitectura, las políticas y otros documentos que suelen solicitar los auditores antes de la evaluación.

##### Prácticas de gestión y entorno de control
La recopilación previa de los datos y documentos le permite al auditor verificar que el alcance establecido es correcto.

Asimismo, establece las prácticas de gestión o los objetivos de control como base de las pruebas en su auditoría.

Las prácticas de gestión sirven como indicadores para determinar que el alcance fue logrado con éxito. A cada práctica de gestión se le asocia un conjunto de actividades, éstas son la evidencia de que se cumple con el objetivo de control propuesto. El auditor debe probar las actividades para saber si arrojan evidencia confiable. Las prácticas de gestión junto con los planes de prueba se conocen como programa de auditoría.

Para llevar a cabo el programa de auditoría, el auditor debe contactar al representante de seguridad de la empresa para solicitar que programe la reunión de apertura. Lo ideal es que el representante reciba al auditor y le facilite la comunicación con el personal TI de la empresa en caso de que se requieran sus servicios durante las pruebas de auditoría.

##### Trabajo de campo, hallazgos y controles compensatorios
En una auditoria el proceso en el que se identifican a las personas, los procesos y la tecnología dentro de un entorno de sistemas se conoce como trabajo de campo.

La comunicación entre el auditor y el experto del área en evaluación debe ser expedita.

El término control compensatorio se usa cuando la práctica de gestión se cumple, aunque la actividad de control que se esperaba no existe, ya que la actividad recién encontrada compensa la falta de la esperada. Esto suele usarse cuando los representantes de seguridad no informan adecuadamente al auditor, ya sea por desconocimiento o inexperiencia.

Si el auditor no encuentra la evidencia de una de las prácticas de gestión, se trata de un hallazgo. En auditoría un hallazgo tiene las siguientes partes:
1. **Condición:** Es la descripción objetiva de la evidencia.
2. **Criterios:** Se menciona el estándar que da indicios de por qué la condición afecta la capacidad de gestión para lograr la práctica de gestión.
3. **Causa:** Lo que originó la debilidad dentro de la práctica.
4. **Efecto:** Indica el riesgo que la condición presenta a la organización auditada con respecto a lo comercial.
5. **Recomendación.**

El auditor tendrá una lista de hallazgos mientras realice el trabajo de campo. Por ello es fundamental el contacto permanente del representante de la empresa con el auditor, para preguntarle por los hallazgos. La función del contacto es buscar evidencias que proporcionen seguridad de que el objetivo de control se está cumpliendo y así se elimine el o los hallazgos.

#### Informe de evaluación
Cualquier auditoría siempre culmina con un informe de evaluación. En él se plasman las observaciones y la opinión del auditor.

La estructura es la siguiente: en primer lugar, se presenta el objetivo, después se describe brevemente la metodología, luego una declaración del auditor y finalmente presenta recomendaciones para reducir el impacto de los hallazgos.


### 428.B7E1.1_Auditoría_de_Sistemas_GNU-Linux

### Auditoría de Sistemas en GNU / Linux
La auditoría de sistemas en GNU/Linux cuenta con varias herramientas para poder realizarla de forma completa. 

Esto facilita enormemente el trabajo de un auditor y al mismo tiempo transforma a este sistema en un espacio donde las auditorias pueden ser mucho más completas, transparentes y legibles. 

Esto es posible gracias a su política de software libre y al hecho de que la información puede ser consultada en bruto mediante herramientas especializadas o las mismas herramientas nativas del sistema.

#### Systemd-journald, transformando la auditoria integrada de GNU/Linux
GNU/Linux ha cambiado mucho en los últimos años, hasta el punto en que muchas de las herramientas de auditoría se han centralizado en un nuevo servicio (o _daemon_, como se conocen en GNU/Linux) llamado _systemd_. 

**systemd**, es un programa con múltiples servicios, siendo el principal de ellos el de inicio del sistema (o init, la parte más importante para iniciar un SO) y sobre este init se construyen una serie de herramientas complementarias, entre ellas la que nos permite obtener información de auditoría de sistema, _systemd-journald_.

_systemd-journald_ es un servicio del sistema que recoge y almacena datos de registro. Crea y mantiene diarios estructurados e indexados basados en la información de registro que se recibe de diversas fuentes:
1. Mensajes de registro del núcleo, a través de _kmsg_ (kernel messeges, una interfaz que nos permite ver los mensajes manejados por el kernel.
2. Mensajes de registro del sistema simples, a través de la llamada _libc_, _syslog_ (una función estándar de libc, que les permite a las aplicaciones enviar información al log de sistema).
3. Mensajes estructurados de registro del sistema a través de la API nativa de Journal. Esto facilita la creación de programas para el análisis minucioso de la información que está en el log.
4. Salida estándar y error estándar de las unidades de servicio. Ya que systemd maneja el inicio (init) del sistema, todos los servicios dependen del mismo para su puesta en marcha, de esta forma, todo mensaje tanto de los servicios/Daemon y programas dependen de enviar su información de logging a systemd y estos son pasados a _systemd-journald_ quien gestiona su almacenamiento y control.
5. Permite crear por defecto registros de auditoría, originados por el subsistema de auditoría del núcleo.

_systemd-journald_ permite mejorar las capacidades de auditoría de los sistemas GNU/Lniux, sin embargo, resulta complejo de manejar y carece de ciertas funciones avanzadas que otras herramientas pueden brindar.

Para usar _systemd-journald_ debes tener un GNU/Linux actual y con soporte para este sistema, algo que la mayoría de distribuciones GNU/Linux ya ofrecen.  

##### Ejemplo de uso de _systemd-journald_
- Supongamos deseamos realizar una auditoría de seguridad y queremos saber que usuarios han usado el computador bajo análisis desde su instalación hasta el actual momento. 
- En este caso _systemd-journald_ tiene herramientas que nos permiten revisar esto de forma muy sencilla usando el comando:
- journalctl --full --unit systemd-logind.service

Esta línea se explica de forma muy rápida:
- **journalctl** es el programa que nos permite controlar y acceder al log del sistema manejado por _systemd-journald_.
- **La opción --full** nos indica que debemos obtener todo el registro, mientras que la opción --unit nos permite indicar el servicio/unidad que analizaremos.

En este caso, como queremos saber los inicios registrados por nuestro computador desde su instalación hasta la actualidad, debemos apuntar a la unidad/servicio systemd-logind.service que es la encargada de esto.

Todo este comando al ser ejecutada en una consola nos permite obtener la siguiente información:

![[428.B7E1_boot.png]]

En la captura se puede ver toda la información de inicios de sesión y booteo (encender desde 0 el computador) desde su instalación hasta la actualidad.

#### Lynis, auditorias de seguridad completa sobre GNU/Linux
- Otra herramienta potente para realizar auditorías de seguridad sobre GNU/Linux, especialmente para endpoints (computadores de nuestros trabajadores) o servidores básicos es Lynis.
- Lynis es una herramienta de auditoría de sistemas de software libre y código abierto, desarrollada y ofrecida por Cisofy. 
- Puede correr en la gran mayoría de sistemas operativos basados en Unix, como GNU/Linux, macOS, OpenBSD, AIX, Solaris y FreeBSD, entre otros. 
- Aunque dispone de muchas opciones de análisis (incluso se puede complementar con plugins), el funcionamiento base es el de analizar una serie de aspectos del sistema y comprobar si la configuración es la correcta.

Antes que nada, es importante aclarar que se trata de un análisis general, que se encarga de analizar parámetros muy dispares entre sí. De hecho, es interesante porqué te permite entender muy bien como la seguridad en GNU/Linux (y en cualquier sistema), no depende en absoluto de una sola herramienta ni configuración, sino que es una suma de muchísimos factores.

Al final, en base a los resultados obtenidos, te ofrecerá una puntuación orientativa sobre 100, lo que ellos denominan el “hardening index”, junto con un buen registro de todos los warnings y las medidas correctivas que te sugiere aplicar. Pero de esto ya hablamos luego al final del examen.

Dependiendo del contexto en el que te encuentres, habrá una serie de puntos que, o directamente no aplicarán, o bien no serán suficientemente importantes como para tenerlos en cuenta, por lo que el propio Lynis ya te recomiende que deshabilites los exámenes que no apliquen en tu caso, para que la puntuación sea más acertada.

Lynis tiene dos opciones: 
1. **Lynis Community:** Una versión gratuita que puedes instalar desde su repositorio de GitHub.
2. **Lynis Enterprise:** Una completa suite de auditoría y hardening para empresas que incluye capacidad de únicas y soluciones que puedes aplicar para alcanzar baselines (Compliance) de seguridad como PCI-DSS, HIPAA, ISO 27001, ISO 27002 y GPDR.

En la siguiente imagen podrás ver parte de la información que Lynis ofrece como parte de su sistema de auditoría para sistemas (usando Ubuntu 22.04 LTS y Lynis Community para la prueba).

![[428.B7E1_lynis.png]]

 #### Otras opciones para auditoria dentro de GNU/Linux
Por supuesto, también existen otras opciones de software para auditoria dentro de ambientes GNU/Linux y entre esas opciones podemos mencionar:
1. **Nessus:** Suite completa de auditoría de sistemas.
2. **Auditd:** Un Daemon/servicio para GNU/Linux que permite mantener un registro de auditoría completa de los sistemas, muy usado en conjunto con AppArmor (un sistema de seguridad avanzado – MAC – dentro de GNU/Linux).
3. **SailPoint:** Una suite comercial de soluciones de auditoría y ciberseguridad para empresas, considerada como una de las más completas del mercado y con soporte tanto para sistemas GNU/Linux como para Windows, MacOS, Android e iOS, lo que le hace perfecta para ambientes heterogéneos.
4. **Tripwire:** es otra solución de auditoría y ciberseguridad que está disponible tanto para sistemas GNU/Linux y Windows.
5. **OpenVAS:** Un analizador de vulnerabilidades y herramienta de auditoría de ciberseguridad que también puedes usar para este tipo de tareas.


### 429.B7E1.1_Auditoría_de_Sistemas_Windows

### Auditoría de Sistemas en Windows
Al igual que GNU/Linux, Windows también cuenta con potentes capacidades de auditoría y revisión de eventos incluidos en el sistema operativo.

Estas opciones pueden revisarse de forma nativa usando dos ejecutables:
1. Directivas de seguridad local
2. Visor de eventos

#### 1 | Directivas de seguridad local
Es un ejecutable que nos permite controlar la forma en como Windows maneja toda la seguridad básica, por defecto, del sistema operativo y todo ello gracias a una ventana desde la que podemos acceder y configurar cada una de las partes.

- Desde aquí, el administrador del sistema, puede configurar las opciones de seguridad que se aplicarán a la instalación de Windows. 
- Un punto positivo de este sistema es que, si forma parte de un Directorio Activo (es decir, está integrado a un servidor Windows empresarial dentro de un grupo AD definido) todas estas tareas pueden ser realizadas en el servidor y aplicarse a cada una de las computadoras que forman parte de la organización de forma automática (conocido como aprovisionamiento AD). 
- Esto también es posible en GNU/Linux, pero no forma parte de esos SO por defecto (a excepción de sus versiones de pago y dirigidas a empresas como Red Hat Linux).
- En todo caso, **Directivas de Seguridad Local** es el espacio donde puedes configurar el nivel de seguridad de Windows, el cual, por defecto, suele ser bastante débil.

  ![[429.B7E1_config.png]]

Puedes configurar, por ejemplo, las directivas de seguridad de las contraseñas de Windows, tal como se puede apreciar en la siguiente imagen:

![[429.B7E1_directivas.png]]

Rápidamente, podemos ver que:
1. Las contraseñas no se almacenan usando criptografía reversible, por lo que no se podrá saber la clave del mismo, si en algún momento se obtiene acceso al archivo donde se almacenan.
2. Se hace auditoría a las contraseñas para que estas tengan como mínimo 8 caracteres de longitud.
3. Se exige un historial de 3 contraseñas (evitando la repetición de contraseñas)
4. La contraseña debe cumplir con requisitos de complejidad (uso de mayúsculas, minúsculas, número y símbolos).
5. Cada contraseña será válida solo por 180 días, luego de eso deberá cambiarse durante un inicio de sistema.

En definitiva, hablamos de una herramienta con capacidad para alterar por completo la funcionalidad de Windows. 

Podemos indicar al sistema que evite que las cuentas de "Administrador" (incluyendo la integrada en el propio Windows) puedan instalar aplicaciones en el sistema o, incluso, bloquearnos el acceso al mismo. Este mismo caso sucede en GNU/Linux si hacemos un bloqueo de cuentas sin tener en cuenta las consecuencias.  
  
**Hay otra opción parecida a la anterior, pero menos agresiva:** 

1. Deshabilitar las cuentas de Administración que vienen por defecto en Windows. 
2. Crear nuestro propio usuario Administrador con otro nombre y contraseña.
3. Hacer que cada usuario no administrador, sin ese rol activo, no pueda hacer elevación de privilegios, impidiéndole instalar software con permisos administrativos.

- Paraleleamente a esto, podemos crear una regla de auditoría que nos avise en caso de que una persona haya querido tener acceso a dichos permisos, lo que nos permitiría detectar el intento y hacer las correcciones pertinentes.  
- El resultado de una política de seguridad de este tipo, es que se reducen los problemas de seguridad de Windows y, al mismo tiempo, se mantiene un alto nivel de seguridad en la organización.

En la siguiente imagen, un ejemplo de la configuración necesaria para este tipo de comportamiento:

![[429.E7B1_comportamiento.png]]

Como puedes ver, las capacidades de Windows en este sentido son enormes, y toda esa información es controlada a nivel interno del sistema, pudiendo ser examinada con la siguiente herramienta:

#### 2 | Visor de eventos
Todo lo que sucede en el sistema queda grabado como un evento que puede ser analizado en el Visor de Eventos de Windows.

![[429.E7U1_visor.png]]

Si el ejecutable de Directivas de seguridad local, te permite ajustar la seguridad y el nivel de auditoría de Windows, el visor de eventos, te permite revisar de forma minuciosa toda la actividad del sistema. Desde las aplicaciones que se inician y el acceso a los privilegios del sistema, hasta los errores y advertencias del kernel y de todos los servicios que tienen lugar en Windows (incluyendo las directivas de seguridad aplicadas).

De esa forma, estos dos ejecutables se transforman en la parte más importante de la seguridad de Windows y de su auditoría a nivel de sistema operativo, algo básico para mantener no solo tus endpoint protegidos, sino también los servidores Windows que puedas tener en tu organización, ya que la seguridad tanto en Server como Desktop de Windows, se puede manejar con las mismas herramientas.

#### Otras herramientas de auditoria para Windows
1. **ADAudit Plus:**  
    Se trata de una potente herramienta de auditoría y análisis para ambientes Windows, con capacidad para integrarse en ambientes de Directorios Activos, Análisis de políticas de grupo para Directorio Activo (GPO AD), chequeo de software y actividad en la redEventLog Analyzer, es otra gran herramienta de auditoría y análisis de eventos y sistema para Windows.
2. **HardeningKitty:**  
    Es una herramienta de doble uso, por un lado, sirve para auditar ciertas configuraciones de seguridad dentro de Windows, por el otro, sirve para desplegar dichas opciones de seguridad y realizar enforce de medidas de seguridad en Windows con vista a cumplir los baselines de seguridad empresarial de Microsoft.

Estas herramientas son básicas para conocer nuestros sistemas y sus capacidades de auditoría (tanto en Windows y GNU/Linux), pero aún queda camino por recorrer, especialmente para hacer enforce o hardening de seguridad, el cual veremos en las siguientes unidades.

# Separación de privilegios
En informática, la separación de privilegios es una técnica que se usa para atenuar el daño potencial de un ataque a la seguridad de una computadora.

Básicamente, consiste en evitar que los usuarios tengan acceso a permisos innecesarios para sus funciones, evitando de esta forma que puedan obtener acceso a partes sensibles de la organización. 

En sistemas operativos como GNU/Linux, Windows o en plataformas Web propias, la separación de privilegios es, y debe ser, parte fundamental de las medidas de seguridad que se toman para proteger la infraestructura, los datos y toda la organización. 

Tomemos el siguiente caso como ejemplo:
- La usuaria "A", es una visitante de SoftTech Inc, una empresa que le ha invitado a probar un nuevo software para dar su _feedback_ desde una web especializada en ciberseguridad. 
- A es una visitante desde el punto de vista del administrador de sistema, por lo que sus permisos deben ser limitados para que solo pueda ver información básica de la empresa. 
- En tal sentido, el acceso a los recursos de la empresa por parte de "A" serán limitados por la estrategia de "separación de privilegios" aplicada por la empresa, garantizando que "A" pueda contactar con las personas autorizadas, acceder al software que probará y su documentación. El resto de los recursos de la empresa están estrictamente prohibidos y, de necesitar algún acceso más elevado, tendrá que pedir autorización explicita al administrador del sistema para que este acceso le sea otorgado (ej: acceso a recursos de impresión, escáner o cualquier otro que requiera). 

En este sencillo ejemplo, podemos ver como "A" es puesta en una especie de zona de seguridad, con límites bien establecidos en cuanto a los recursos que puede usar y cómo puede usarlos. Desde un principio "A" tiene el menor privilegio posible para que realice su trabajo y solo podrá obtener más privilegios si realiza la petición de los mismos y el análisis del administrador de sistema le da acceso. 

El ejemplo se puede llevar a niveles de total y práctica paranoia, especialmente si el ambiente al que se está entrando es de extrema seguridad y confidencialidad. Por ejemplo, hay empresas donde ingresar un pendrive está totalmente prohibido y tener uno en tu poder puede llevarte a tener graves problemas, incluso legales. En otras empresas, está prohibido que los empleados, incluso los de alto nivel (ej: un directivo), puedan acceder a determinados espacios y de hacerlo también se corre el riesgo de tener problemas legales o directamente enfrentar una sanción laboral (llegando a niveles de despido si la falta es grave). 

**Este ejemplo anterior nos dice una cosa:** La separación de privilegios no solo se da a nivel digital (en equipos, sistemas informáticos y más) sino también a nivel físico, todo ello de acuerdo a las medidas de seguridad que se deseen aplicar en la organización. Dicho esto, nos centraremos en la separación de privilegios digitales y hablaremos de cómo se realiza la misma.

## Principio de menor privilegio
En su forma más básica, un programa de computadora se bifurca en dos procesos. El programa principal descarta sus privilegios más altos y el programa más pequeño mantiene privilegios altos, con el fin de realizar tareas muy determinadas, por medio de una comunicación interproceso segura.

De esta manera, cualquier ataque exitoso contra el programa principal ganará un acceso mínimo, a pesar de que el par de programas será aún capaz de realizar operaciones privilegiadas.

Básicamente el principio se reduce a:
> "Garantiza a todas las partes de un sistema, solo los privilegios necesarios para que puedan realizar su trabajo, el resto prohíbelo."

Este principio lo podemos encontrar en cualquier sistema operativo actual y es la base fundamental con el que se inicia la seguridad en dichos sistemas. Por supuesto, este esquema se ha hecho más complejo a medida que las necesidades de seguridad en informática se han hecho más complejas. 

Por supuesto, este drop o abandono de privilegios funciona a varios niveles que examinaremos a continuación: 

1. Sistema Operativo
2. Aplicaciones

### A nivel de sistema operativo
Con la llegada de los sistemas multi-usuario, se generaron estructuras de permisos que incluyen la creación de usuarios y grupos.

De esta manera, se pueden crear usuarios con permisos distintos y específicos, y grupos que pueden compartir un conjunto de permisos global, con lo que se lograr tener una gran granularidad a la hora de ofrecer acceso a ciertos recursos computacionales o informáticos.

Este sistema lo vimos primero en sistemas UNIX donde su ambiente multiusaurio llevó a la creación de este sistema de permisos, que hoy en día se conoce como DAC (Discretionary Access Control o Control de Acceso Discrecional). Este sistema es básico en sistemas operativos como GNU/Linux, OpenBSD, NetBSD, Solaris, FreeBSD y básicamente cualquier UNIX-like. 

Por supuesto, este sistema ha sido mejorado a lo largo de los años con el fin de ofrecer controles de acceso mucho más finos y seguros, como lo es la inclusión de ACL (Access Control List o Listas de Control de Acceso), funciones especiales como los namespace y capabilities (estas son funciones especiales a nivel de kernel que garantizan acceso a funciones privilegiadas a su nivel). En todo caso, los programas pueden hacer uso de estas funciones de forma individual o en conjunto, con el fin de garantizar acceso a los permisos que necesitan en momentos específicos y el resto simplemente los desechan cuando ya no son necesarios. De esta manera, los desarrolladores crean software que es seguro en su más bajo nivel. 

Sin embargo, incluso con este nivel de seguridad, la informática necesita de niveles más altos de seguridad y es allí donde llegan aproximaciones como MAC (Mandatory Access Control o Control de Acceso Mandatory). En este caso, los sistemas más conocidos con SELinux (creado por la NSA para el sistema operativo Linux e integrado de forma predeterminada al kernel), AppArmor (desarrollado por Novell para Linux e integrado al kernel de forma predeterminada), Tomoyo (creado por NTT Data para Linux, forma parte del kernel), Capsicum (creado por la Universidad de Cambridge para FreeBSD) y MAC (creado para FreeBSD por el equipo de desarrollo). 

Seguramente te llama la atención que una herramienta de la NSA (cuyo trabajo es romper sistema y espiarte) esté dentro de una lista de sistema de seguridad y, que además forme parte de Linux siendo este un proyecto libre. Pero la realidad del código es innegable, SELinux es seguro, de hecho, de toda la lista es el sistema más seguro en su tipo (hablando de MAC). 

Ahora bien ¿qué diferencias hay entre estos sistemas (DAC y MAC)? Un ejemplo rápido puede darte una idea clara de cómo se puede aplicar el principio de menor privilegio usando estos sistemas:

- **Supongamos que ejecutamos Firefox en un sistema Ubuntu.** Resulta que hemos visitado una Web y hay un código malicioso que intenta obtener información de nuestro sistema específicamente de la carpeta /home/usuario/.ssh, con el fin de robar nuestras claves SSH y vulnerar cualquier sistema en el que hayamos registrado la misma. 

Así tenemos dos posibles resultados:
1. En una instalación por defecto de Ubuntu (AppArmor instalado, pero desactivado, solo funciona el sistema DAC), la Web maliciosa que ha comprometido el proceso de Firefox podrá leer la carpeta /home/usuario/.ssh y cualquier dato en nuestra carpeta de usuarios, porque siendo un proceso iniciado por nosotros, Firefox tiene esa capacidad y permiso. En pocas palabras, hemos sido vulnerados incluso contando con una instalación "segura" por defecto y toda la separación de privilegios que Firefox y el sistema DAC nos ofrece. 
2. En una instalación fortalecida de Ubuntu (AppArmor instalado y activo), este evento podría evitarse con una regla explicita para AppArmor que evite el acceso a la carpeta /home/usuario/.ssh. Incluso aunque Firefox es ejecutado con nuestros permisos (DAC por defecto), la protección de MAC (dada por AppArmor) evitaría y registraría para su posterior auditoria el acceso a dicha información porque el administrador de sistema ha especificado que dicha carpeta no puede ser accedido por Firefox (o cualquier otro programa que se configure como tal). 

Básicamente, la seguridad de MAC evitaría que el programa lea esos archivos, y no se puede traspasar esa seguridad a menos que se comprometa el kernel del sistema (algo mucho más complejo y difícil) lo que agrega más seguridad. 

Los sistemas MAC pueden incluso prohibir a los programas acceso privilegiado a las capabalities o capacidades a nivel del kernel, restringiendo aún más sus permisos, incluso más allá de las restricciones creadas por sus desarrolladores, por lo que se convierten en una herramienta poderosa para cumplir con el principio del menor privilegio. 

En Windows, esta capacidad también es posible y con un nivel de granularidad mucho mayor debido a que Windows usa un sistema híbrido. Por un lado, es capaz de usar un sistema DAC (con usuarios, grupos y ACLs) al que se les añade soporte a descriptores de seguridad (SIDs) que son aplicados a nivel de sistema de archivo (una estructura que te permite almacenar información de forma legible para la computadora). 

Además, Windows también es capaz de crear una estructura de seguridad basada en RBAC (Role Based Access Control - Control de Acceso Basado en Roles) que completa su seguridad no solo a nivel de sistema operativo, sino de organización (nuevamente, gracias a los servicios de Directorio Activo). 

Finalmente, Windows también aplica sistemas de permisos MAC conocido como (Mandatory Integrity Control), el cual podemos ver aplicado en la siguiente imagen:

![[430.B7E1_mandatory.png]]

Todo esto deja muy en claro que el principio de menor privilegio, no solo es una buena practica de seguridad, sino que es el principio de una serie de medidas que se encaminan a proteger el sistema operativo y las aplicaciones que se ejecutan sobre el mismo.

### A nivel de aplicaciones
Ahora bien, todo lo anterior enmarca una serie de protecciones que es posible habilitar y usar en nuestro sistema operativo y que, por tanto, también pueden ser usadas en las aplicaciones que se desarrollen para el mismo. 

Por supuesto, en el caso de que esas aplicaciones sean Web, la aplicación de estas medidas directamente no es posible, pero también aplica el hecho de separar las funciones relevantes de esa aplicación para que solo sean accesible por aquellos con el nivel de privilegio necesario para acceder a dichas funciones. 

¿Pero cómo se aplica este principio de menor privilegio en aplicaciones?. Veamos dos ejemplos:

#### 1 | El caso de Firefox como aplicación de escritorio 
Los desarrolladores de Firefox usan funciones especiales a nivel de kernel y de herramientas del sistema operativo, para garantizar que la aplicación solo use los privilegios necesarios para su funcionamiento. 

En tal caso, los devs se aseguran de tomar esos privilegios, crear estructuras de seguridad (como un sandbox) para aislar las partes delicadas y delimitar lo que pueden hacer. De esa manera se aseguran que el navegador solo use los recursos que necesita (ej: para mostrarte un vídeo en pantalla y reproducir el sonido, Firefox debe ser capaz de acceder a la gráfica de tu computador y la tarjeta de sonido, escribir los datos necesarios para que el controlador de esos dispositivos muestre la imagen y reproduzca el sonido que estás viendo). 

Esto, por supuesto, es una buena practica de seguridad y en condiciones normales puede ofrecer un alto nivel de seguridad, pero en muchos casos, incluso estas medidas de seguridad pueden no ser suficientes para garantizar el principio de mínimo privilegio. Esto se debe a que las funciones para lograrlo no están bien mantenidas o bien porque se ha de usar un alto nivel de acceso para asegurar su funcionamiento y luego dropear ese nivel de acceso a su mínimo. 

En ambos casos, existe una ventana de oportunidad para explotar el sistema y por ello los administradores deben conocer y estudiar el software que se usa en una organización para pensar en forma de evitar tales casos, incluso si son improbables que sucedan. 

#### 2 | El caso de Firefox para GNU/Linux.
En este caso, los desarrolladores hacen uso de tres _capabilities_ a nivel del kernel. Estas _capabilities_ son funciones de alto nivel de acceso por medio del kernel que, si bien son "seguras", han sido el punto de origen de muchos problemas de seguridad (y seguirán siéndolo). 

Esas _capabilities_ usadas por Firefox son:
1. **CAP_SYS_CHROOT,** que le permite crear un entorno de "root falso", útil para hacer un sandbox.
2. **CAP_SYS_ADMIN,** que le permite al proceso de Firefox obtener permisos administrativos (durante el inicio del proceso para configurar el acceso necesario a los recursos del sistema). 
3. **CAP_SYS_PTRACE,** le permite acceder a funciones de _debug_ de procesos.
4. **CAP_SYS_SETGID y CAP_SYS_SETUID,** funciones especiales a nivel del kernel para manipular descriptores de usuarios y grupos. 
5. **Acceso a user_namespace (userns),** para crear espacios de ejecución separados y seguros. 

**Un análisis de seguridad rápido, ya nos da una advertencia rápida:** Firefox no debería tener acceso a tales funciones, porque es un riesgo de seguridad. El simple hecho de que incluso la documentación oficial del kernel Linux ya indiqué que no debes usar CAP_SYS_ADMIN, salvo casos muy especiales, es un llamado de atención, porque el acceso administrativo no debería ser tan fácilmente usado (nuevamente, el principio es usar la menor cantidad de permisos para un programa). 

Esta situación ha llevado a que las organizaciones preocupadas por la ciberseguridad se usen sistemas MAC para prohibir que Firefox acceda a esas funciones especiales, y al mismo tiempo, para evitar que pueda acceder e interactuar con elementos que no son necesarios para su funcionamiento. Un buen ejemplo de esto, lo vemos aplicado en el proyecto Chromium quien lleva bastante tiempo desarrollando nuevas formas de sandboxing dejando de lado estas capabilities y al mismo tiempo ofreciendo niveles de seguridad parecidos o superiores. 

Ahora bien, este principio de menor privilegio también puede aplicarse a nivel de aplicaciones Web, y para ello se sigue el mismo proceso: se crea un núcleo administrativo al que solo pueden acceder completamente ciertos usuarios configurados para tal fin, y el resto solo podrán acceder a los niveles permitidos, usando para ello todos los elementos de seguridad y autenticación que los frameworks usados nos permitan. 

![[430.B7E1_linux.png]]

### Segregación de funciones de usuarios y del personal de IT.
Acciones que deben llevar a cabo los administradores de sistemas para proteger los sistemas informáticos de la compañía y evitar la elevación de privilegios entre roles y sistemas:
1. **Separación de roles.**  
    En este caso, se debe tener en cuenta que los usuarios deben usar cuentas distintas para actividades cotidianas y para labores de administración (Ej: DOMAIN\luser y DOMAIN\adm.luser). La cuenta de administrador no tendrá buzón de correo, permisos de navegación, entre otros, que pueden poner en riesgo dicha cuenta.
2. **Compartimentalizar el acceso a recursos.**  
    Esto significa que las labores de administración estarán compartimentalizadas, de tal forma un único administrador no debe tener acceso a la plataforma, el almacenamiento y backups al mismo tiempo. También se pueden usar estrategias de aislamiento en base a distribución geográfica.
3. **Separación de entornos.**  
    Las cuentas de administradores no deberán loguearse en los mismos escritorios donde se utiliza la navegación y el correo. Por tanto, deberán utilizarse "máquinas de salto" dedicadas y aisladas para las labores de administración.
4. **Aislamiento VLAN de administración.**  
    Los equipos de escritorio no deben tener conectividad directa con los servidores y DMZ (Zona Desmilitarizada). Solo deben alcanzar a las "máquinas de salto" situadas en la VLAN (LAN Virtuales) de administración, serán estas las que puedan conectar a los servidores. Deberán crearse las máquinas de salto necesarias para compartimentalizar la administración en distintos segmentos.
5. **Principio del mínimo privilegio para cuentas de servicio.**  
    Las cuentas de servicio deberán poder iniciar sesión únicamente en el parque de servidores destinado a ese servicio. Se establecerán las medidas de monitorización que alerten cuando estas son usadas desde / hacia otras ubicaciones o cuando el tipo de inicio de sesión no coincide con el esperado.
6. Utilización de herramientas de monitorización hostids o EDR, seguridad endpoints y elementos de red para la detección de patrones de escalada de privilegios y explotación hacia otros sistemas.
7. El uso de máquinas virtuales, contenedores o jaulas (jails) para llevar a cabo las tareas no privilegiadas, como la navegación o la creación de servicios, esta es una buena práctica de seguridad y facilita la puesta en marcha de los mismos y su mantenimiento.

### Bloqueos y controles de seguridad a nivel de red
Acciones a nivel de red con las que bloquear tráfico malicioso.

1. **Segmentación.**  
    Segmentar la red en VLANs y aplicar reglas de filtrado a nivel de red y de puestos de trabajo y servidores, limitando por ejemplo las conexiones RDP y SMB. 
2. **Servicios de reputación IP.**  
    Bloquear tráfico de navegación a TOR o a sistemas no clasificados. Se puede hacer uso de servicios gratuitos como https://check.torproject.org/cgi-bin/TorBulkExitList.py o https://www.dan.me.uk/torlist/, así como de feeds comerciales que identifiquen VPNs o IPs de dudosa reputación.
3. **Bloqueo de tráfico a Internet.**  
    Los sistemas internos (tanto servidores como puestos de trabajo) no deberían tener acceso directo a internet. El tráfico DNS, HTTP y HTTPs debe estar restringido al proxy de navegación, que incluya ACLs restrictivas.
4. **Estudio de rutas de compromiso.**  
    Realización de tests de intrusión periódicos o de ejercicios de red team para descubrir rutas de compromiso y mejorar los procedimientos de respuesta ante incidentes.
5. **Monitorizar accesos remotos.**  
    Monitorizar y controlar las conexiones VPN, Citrix, RDP o VDI entrantes. Es recomendable agregar doble factor de autenticación a todos los grupos autorizados para establecer conexiones remotas y notificar al usuario de la conexión.

### Medidas de seguridad a nivel de sistemas
Acciones que se pueden llevar a cabo para lograr la protección del puesto de trabajo.

1. **Firewall del sistema operativo.**  
    Bloqueo de tráfico y comunicaciones a servicios de SMB, tanto a nivel de firewall como de aislamiento de estaciones de trabajo dentro de su mismo segmento de red.
2. **Actualizaciones de seguridad.**  
    Controlar de forma centralizada las actualizaciones de seguridad de estaciones de trabajo y servidores haciendo uso de soluciones de control de actualizaciones como WSUS.
3. **Contraseñas.**  
    La gestión de contraseñas es otro de esos aspectos que puede suponer un artículo en mismo. A grandes rasgos, no permitir la compartición de contraseñas de administrador local ni de usuarios administrativos entre grupos de servidores y de estaciones de trabajo. Además, las directivas de contraseñas deben evitar patrones predecibles (meses, años, nombre de la empresa). Esto se puede complementar con el reseteo periódico de tickets de kerberos para prevenir ataques de persistencia.
4. **Bloqueos de ejecución.**  
    Bloqueo de herramientas de volcado de contraseñas de memoria, protecciones y endurecimiento de entornos de ejecución. 
5. **Hardening.**  
    Creación y mantenimiento de guías de _hardening_ o _bastionado_ para garantizar cifrado de comunicaciones, protecciones frente a ataques de MITM (Man-in-the-Middle) es fundamental. En el caso puntual de un servidor de ficheros, se pueden prevenir las acciones maliciosas llevas a cabo por un _ransomware_ o por un atacante y definir una estrategia de prevención en servidores de ficheros con la implantación de FSRM. FSRM es un rol de los servidores de ficheros de Microsoft que permite definir acciones y ejecutar scripts frente a la escritura de ciertos tipos de ficheros.


### 430.B7E1.2_Separación_de_privilegios

### Separación de privilegios
En informática, la separación de privilegios es una técnica que se usa para atenuar el daño potencial de un ataque a la seguridad de una computadora.

Básicamente, consiste en evitar que los usuarios tengan acceso a permisos innecesarios para sus funciones, evitando de esta forma que puedan obtener acceso a partes sensibles de la organización. 

En sistemas operativos como GNU/Linux, Windows o en plataformas Web propias, la separación de privilegios es, y debe ser, parte fundamental de las medidas de seguridad que se toman para proteger la infraestructura, los datos y toda la organización. 

Tomemos el siguiente caso como ejemplo:
- La usuaria "A", es una visitante de SoftTech Inc, una empresa que le ha invitado a probar un nuevo software para dar su _feedback_ desde una web especializada en ciberseguridad. 
- A es una visitante desde el punto de vista del administrador de sistema, por lo que sus permisos deben ser limitados para que solo pueda ver información básica de la empresa. 
- En tal sentido, el acceso a los recursos de la empresa por parte de "A" serán limitados por la estrategia de "separación de privilegios" aplicada por la empresa, garantizando que "A" pueda contactar con las personas autorizadas, acceder al software que probará y su documentación. El resto de los recursos de la empresa están estrictamente prohibidos y, de necesitar algún acceso más elevado, tendrá que pedir autorización explicita al administrador del sistema para que este acceso le sea otorgado (ej: acceso a recursos de impresión, escáner o cualquier otro que requiera). 

En este sencillo ejemplo, podemos ver como "A" es puesta en una especie de zona de seguridad, con límites bien establecidos en cuanto a los recursos que puede usar y cómo puede usarlos. Desde un principio "A" tiene el menor privilegio posible para que realice su trabajo y solo podrá obtener más privilegios si realiza la petición de los mismos y el análisis del administrador de sistema le da acceso. 

El ejemplo se puede llevar a niveles de total y práctica paranoia, especialmente si el ambiente al que se está entrando es de extrema seguridad y confidencialidad. Por ejemplo, hay empresas donde ingresar un pendrive está totalmente prohibido y tener uno en tu poder puede llevarte a tener graves problemas, incluso legales. En otras empresas, está prohibido que los empleados, incluso los de alto nivel (ej: un directivo), puedan acceder a determinados espacios y de hacerlo también se corre el riesgo de tener problemas legales o directamente enfrentar una sanción laboral (llegando a niveles de despido si la falta es grave). 

**Este ejemplo anterior nos dice una cosa:** La separación de privilegios no solo se da a nivel digital (en equipos, sistemas informáticos y más) sino también a nivel físico, todo ello de acuerdo a las medidas de seguridad que se deseen aplicar en la organización. Dicho esto, nos centraremos en la separación de privilegios digitales y hablaremos de cómo se realiza la misma.

#### Principio de menor privilegio
En su forma más básica, un programa de computadora se bifurca en dos procesos. El programa principal descarta sus privilegios más altos y el programa más pequeño mantiene privilegios altos, con el fin de realizar tareas muy determinadas, por medio de una comunicación interproceso segura.

De esta manera, cualquier ataque exitoso contra el programa principal ganará un acceso mínimo, a pesar de que el par de programas será aún capaz de realizar operaciones privilegiadas.

Básicamente el principio se reduce a:
> "Garantiza a todas las partes de un sistema, solo los privilegios necesarios para que puedan realizar su trabajo, el resto prohíbelo."

Este principio lo podemos encontrar en cualquier sistema operativo actual y es la base fundamental con el que se inicia la seguridad en dichos sistemas. Por supuesto, este esquema se ha hecho más complejo a medida que las necesidades de seguridad en informática se han hecho más complejas. 

Por supuesto, este drop o abandono de privilegios funciona a varios niveles que examinaremos a continuación: 

1. Sistema Operativo
2. Aplicaciones

##### A nivel de sistema operativo
Con la llegada de los sistemas multi-usuario, se generaron estructuras de permisos que incluyen la creación de usuarios y grupos.

De esta manera, se pueden crear usuarios con permisos distintos y específicos, y grupos que pueden compartir un conjunto de permisos global, con lo que se lograr tener una gran granularidad a la hora de ofrecer acceso a ciertos recursos computacionales o informáticos.

Este sistema lo vimos primero en sistemas UNIX donde su ambiente multiusaurio llevó a la creación de este sistema de permisos, que hoy en día se conoce como DAC (Discretionary Access Control o Control de Acceso Discrecional). Este sistema es básico en sistemas operativos como GNU/Linux, OpenBSD, NetBSD, Solaris, FreeBSD y básicamente cualquier UNIX-like. 

Por supuesto, este sistema ha sido mejorado a lo largo de los años con el fin de ofrecer controles de acceso mucho más finos y seguros, como lo es la inclusión de ACL (Access Control List o Listas de Control de Acceso), funciones especiales como los namespace y capabilities (estas son funciones especiales a nivel de kernel que garantizan acceso a funciones privilegiadas a su nivel). En todo caso, los programas pueden hacer uso de estas funciones de forma individual o en conjunto, con el fin de garantizar acceso a los permisos que necesitan en momentos específicos y el resto simplemente los desechan cuando ya no son necesarios. De esta manera, los desarrolladores crean software que es seguro en su más bajo nivel. 

Sin embargo, incluso con este nivel de seguridad, la informática necesita de niveles más altos de seguridad y es allí donde llegan aproximaciones como MAC (Mandatory Access Control o Control de Acceso Mandatory). En este caso, los sistemas más conocidos con SELinux (creado por la NSA para el sistema operativo Linux e integrado de forma predeterminada al kernel), AppArmor (desarrollado por Novell para Linux e integrado al kernel de forma predeterminada), Tomoyo (creado por NTT Data para Linux, forma parte del kernel), Capsicum (creado por la Universidad de Cambridge para FreeBSD) y MAC (creado para FreeBSD por el equipo de desarrollo). 

Seguramente te llama la atención que una herramienta de la NSA (cuyo trabajo es romper sistema y espiarte) esté dentro de una lista de sistema de seguridad y, que además forme parte de Linux siendo este un proyecto libre. Pero la realidad del código es innegable, SELinux es seguro, de hecho, de toda la lista es el sistema más seguro en su tipo (hablando de MAC). 

Ahora bien ¿qué diferencias hay entre estos sistemas (DAC y MAC)? Un ejemplo rápido puede darte una idea clara de cómo se puede aplicar el principio de menor privilegio usando estos sistemas:

- **Supongamos que ejecutamos Firefox en un sistema Ubuntu.** Resulta que hemos visitado una Web y hay un código malicioso que intenta obtener información de nuestro sistema específicamente de la carpeta /home/usuario/.ssh, con el fin de robar nuestras claves SSH y vulnerar cualquier sistema en el que hayamos registrado la misma. 

Así tenemos dos posibles resultados:
1. En una instalación por defecto de Ubuntu (AppArmor instalado, pero desactivado, solo funciona el sistema DAC), la Web maliciosa que ha comprometido el proceso de Firefox podrá leer la carpeta /home/usuario/.ssh y cualquier dato en nuestra carpeta de usuarios, porque siendo un proceso iniciado por nosotros, Firefox tiene esa capacidad y permiso. En pocas palabras, hemos sido vulnerados incluso contando con una instalación "segura" por defecto y toda la separación de privilegios que Firefox y el sistema DAC nos ofrece. 
2. En una instalación fortalecida de Ubuntu (AppArmor instalado y activo), este evento podría evitarse con una regla explicita para AppArmor que evite el acceso a la carpeta /home/usuario/.ssh. Incluso aunque Firefox es ejecutado con nuestros permisos (DAC por defecto), la protección de MAC (dada por AppArmor) evitaría y registraría para su posterior auditoria el acceso a dicha información porque el administrador de sistema ha especificado que dicha carpeta no puede ser accedido por Firefox (o cualquier otro programa que se configure como tal). 

Básicamente, la seguridad de MAC evitaría que el programa lea esos archivos, y no se puede traspasar esa seguridad a menos que se comprometa el kernel del sistema (algo mucho más complejo y difícil) lo que agrega más seguridad. 

Los sistemas MAC pueden incluso prohibir a los programas acceso privilegiado a las capabalities o capacidades a nivel del kernel, restringiendo aún más sus permisos, incluso más allá de las restricciones creadas por sus desarrolladores, por lo que se convierten en una herramienta poderosa para cumplir con el principio del menor privilegio. 

En Windows, esta capacidad también es posible y con un nivel de granularidad mucho mayor debido a que Windows usa un sistema híbrido. Por un lado, es capaz de usar un sistema DAC (con usuarios, grupos y ACLs) al que se les añade soporte a descriptores de seguridad (SIDs) que son aplicados a nivel de sistema de archivo (una estructura que te permite almacenar información de forma legible para la computadora). 

Además, Windows también es capaz de crear una estructura de seguridad basada en RBAC (Role Based Access Control - Control de Acceso Basado en Roles) que completa su seguridad no solo a nivel de sistema operativo, sino de organización (nuevamente, gracias a los servicios de Directorio Activo). 

Finalmente, Windows también aplica sistemas de permisos MAC conocido como (Mandatory Integrity Control), el cual podemos ver aplicado en la siguiente imagen:

![[430.B7E1_mandatory.png]]

Todo esto deja muy en claro que el principio de menor privilegio, no solo es una buena practica de seguridad, sino que es el principio de una serie de medidas que se encaminan a proteger el sistema operativo y las aplicaciones que se ejecutan sobre el mismo.

##### A nivel de aplicaciones
Ahora bien, todo lo anterior enmarca una serie de protecciones que es posible habilitar y usar en nuestro sistema operativo y que, por tanto, también pueden ser usadas en las aplicaciones que se desarrollen para el mismo. 

Por supuesto, en el caso de que esas aplicaciones sean Web, la aplicación de estas medidas directamente no es posible, pero también aplica el hecho de separar las funciones relevantes de esa aplicación para que solo sean accesible por aquellos con el nivel de privilegio necesario para acceder a dichas funciones. 

¿Pero cómo se aplica este principio de menor privilegio en aplicaciones?. Veamos dos ejemplos:

###### 1 | El caso de Firefox como aplicación de escritorio 
Los desarrolladores de Firefox usan funciones especiales a nivel de kernel y de herramientas del sistema operativo, para garantizar que la aplicación solo use los privilegios necesarios para su funcionamiento. 

En tal caso, los devs se aseguran de tomar esos privilegios, crear estructuras de seguridad (como un sandbox) para aislar las partes delicadas y delimitar lo que pueden hacer. De esa manera se aseguran que el navegador solo use los recursos que necesita (ej: para mostrarte un vídeo en pantalla y reproducir el sonido, Firefox debe ser capaz de acceder a la gráfica de tu computador y la tarjeta de sonido, escribir los datos necesarios para que el controlador de esos dispositivos muestre la imagen y reproduzca el sonido que estás viendo). 

Esto, por supuesto, es una buena practica de seguridad y en condiciones normales puede ofrecer un alto nivel de seguridad, pero en muchos casos, incluso estas medidas de seguridad pueden no ser suficientes para garantizar el principio de mínimo privilegio. Esto se debe a que las funciones para lograrlo no están bien mantenidas o bien porque se ha de usar un alto nivel de acceso para asegurar su funcionamiento y luego dropear ese nivel de acceso a su mínimo. 

En ambos casos, existe una ventana de oportunidad para explotar el sistema y por ello los administradores deben conocer y estudiar el software que se usa en una organización para pensar en forma de evitar tales casos, incluso si son improbables que sucedan. 

###### 2 | El caso de Firefox para GNU/Linux.
En este caso, los desarrolladores hacen uso de tres _capabilities_ a nivel del kernel. Estas _capabilities_ son funciones de alto nivel de acceso por medio del kernel que, si bien son "seguras", han sido el punto de origen de muchos problemas de seguridad (y seguirán siéndolo). 

Esas _capabilities_ usadas por Firefox son:
1. **CAP_SYS_CHROOT,** que le permite crear un entorno de "root falso", útil para hacer un sandbox.
2. **CAP_SYS_ADMIN,** que le permite al proceso de Firefox obtener permisos administrativos (durante el inicio del proceso para configurar el acceso necesario a los recursos del sistema). 
3. **CAP_SYS_PTRACE,** le permite acceder a funciones de _debug_ de procesos.
4. **CAP_SYS_SETGID y CAP_SYS_SETUID,** funciones especiales a nivel del kernel para manipular descriptores de usuarios y grupos. 
5. **Acceso a user_namespace (userns),** para crear espacios de ejecución separados y seguros. 

**Un análisis de seguridad rápido, ya nos da una advertencia rápida:** Firefox no debería tener acceso a tales funciones, porque es un riesgo de seguridad. El simple hecho de que incluso la documentación oficial del kernel Linux ya indiqué que no debes usar CAP_SYS_ADMIN, salvo casos muy especiales, es un llamado de atención, porque el acceso administrativo no debería ser tan fácilmente usado (nuevamente, el principio es usar la menor cantidad de permisos para un programa). 

Esta situación ha llevado a que las organizaciones preocupadas por la ciberseguridad se usen sistemas MAC para prohibir que Firefox acceda a esas funciones especiales, y al mismo tiempo, para evitar que pueda acceder e interactuar con elementos que no son necesarios para su funcionamiento. Un buen ejemplo de esto, lo vemos aplicado en el proyecto Chromium quien lleva bastante tiempo desarrollando nuevas formas de sandboxing dejando de lado estas capabilities y al mismo tiempo ofreciendo niveles de seguridad parecidos o superiores. 

Ahora bien, este principio de menor privilegio también puede aplicarse a nivel de aplicaciones Web, y para ello se sigue el mismo proceso: se crea un núcleo administrativo al que solo pueden acceder completamente ciertos usuarios configurados para tal fin, y el resto solo podrán acceder a los niveles permitidos, usando para ello todos los elementos de seguridad y autenticación que los frameworks usados nos permitan. 

![[430.B7E1_linux.png]]

##### Segregación de funciones de usuarios y del personal de IT.
Acciones que deben llevar a cabo los administradores de sistemas para proteger los sistemas informáticos de la compañía y evitar la elevación de privilegios entre roles y sistemas:
1. **Separación de roles.**  
    En este caso, se debe tener en cuenta que los usuarios deben usar cuentas distintas para actividades cotidianas y para labores de administración (Ej: DOMAIN\luser y DOMAIN\adm.luser). La cuenta de administrador no tendrá buzón de correo, permisos de navegación, entre otros, que pueden poner en riesgo dicha cuenta.
2. **Compartimentalizar el acceso a recursos.**  
    Esto significa que las labores de administración estarán compartimentalizadas, de tal forma un único administrador no debe tener acceso a la plataforma, el almacenamiento y backups al mismo tiempo. También se pueden usar estrategias de aislamiento en base a distribución geográfica.
3. **Separación de entornos.**  
    Las cuentas de administradores no deberán loguearse en los mismos escritorios donde se utiliza la navegación y el correo. Por tanto, deberán utilizarse "máquinas de salto" dedicadas y aisladas para las labores de administración.
4. **Aislamiento VLAN de administración.**  
    Los equipos de escritorio no deben tener conectividad directa con los servidores y DMZ (Zona Desmilitarizada). Solo deben alcanzar a las "máquinas de salto" situadas en la VLAN (LAN Virtuales) de administración, serán estas las que puedan conectar a los servidores. Deberán crearse las máquinas de salto necesarias para compartimentalizar la administración en distintos segmentos.
5. **Principio del mínimo privilegio para cuentas de servicio.**  
    Las cuentas de servicio deberán poder iniciar sesión únicamente en el parque de servidores destinado a ese servicio. Se establecerán las medidas de monitorización que alerten cuando estas son usadas desde / hacia otras ubicaciones o cuando el tipo de inicio de sesión no coincide con el esperado.
6. Utilización de herramientas de monitorización hostids o EDR, seguridad endpoints y elementos de red para la detección de patrones de escalada de privilegios y explotación hacia otros sistemas.
7. El uso de máquinas virtuales, contenedores o jaulas (jails) para llevar a cabo las tareas no privilegiadas, como la navegación o la creación de servicios, esta es una buena práctica de seguridad y facilita la puesta en marcha de los mismos y su mantenimiento.

##### Bloqueos y controles de seguridad a nivel de red
Acciones a nivel de red con las que bloquear tráfico malicioso.

1. **Segmentación.**  
    Segmentar la red en VLANs y aplicar reglas de filtrado a nivel de red y de puestos de trabajo y servidores, limitando por ejemplo las conexiones RDP y SMB. 
2. **Servicios de reputación IP.**  
    Bloquear tráfico de navegación a TOR o a sistemas no clasificados. Se puede hacer uso de servicios gratuitos como https://check.torproject.org/cgi-bin/TorBulkExitList.py o https://www.dan.me.uk/torlist/, así como de feeds comerciales que identifiquen VPNs o IPs de dudosa reputación.
3. **Bloqueo de tráfico a Internet.**  
    Los sistemas internos (tanto servidores como puestos de trabajo) no deberían tener acceso directo a internet. El tráfico DNS, HTTP y HTTPs debe estar restringido al proxy de navegación, que incluya ACLs restrictivas.
4. **Estudio de rutas de compromiso.**  
    Realización de tests de intrusión periódicos o de ejercicios de red team para descubrir rutas de compromiso y mejorar los procedimientos de respuesta ante incidentes.
5. **Monitorizar accesos remotos.**  
    Monitorizar y controlar las conexiones VPN, Citrix, RDP o VDI entrantes. Es recomendable agregar doble factor de autenticación a todos los grupos autorizados para establecer conexiones remotas y notificar al usuario de la conexión.

##### Medidas de seguridad a nivel de sistemas
Acciones que se pueden llevar a cabo para lograr la protección del puesto de trabajo.

1. **Firewall del sistema operativo.**  
    Bloqueo de tráfico y comunicaciones a servicios de SMB, tanto a nivel de firewall como de aislamiento de estaciones de trabajo dentro de su mismo segmento de red.
2. **Actualizaciones de seguridad.**  
    Controlar de forma centralizada las actualizaciones de seguridad de estaciones de trabajo y servidores haciendo uso de soluciones de control de actualizaciones como WSUS.
3. **Contraseñas.**  
    La gestión de contraseñas es otro de esos aspectos que puede suponer un artículo en mismo. A grandes rasgos, no permitir la compartición de contraseñas de administrador local ni de usuarios administrativos entre grupos de servidores y de estaciones de trabajo. Además, las directivas de contraseñas deben evitar patrones predecibles (meses, años, nombre de la empresa). Esto se puede complementar con el reseteo periódico de tickets de kerberos para prevenir ataques de persistencia.
4. **Bloqueos de ejecución.**  
    Bloqueo de herramientas de volcado de contraseñas de memoria, protecciones y endurecimiento de entornos de ejecución. 
5. **Hardening.**  
    Creación y mantenimiento de guías de _hardening_ o _bastionado_ para garantizar cifrado de comunicaciones, protecciones frente a ataques de MITM (Man-in-the-Middle) es fundamental. En el caso puntual de un servidor de ficheros, se pueden prevenir las acciones maliciosas llevas a cabo por un _ransomware_ o por un atacante y definir una estrategia de prevención en servidores de ficheros con la implantación de FSRM. FSRM es un rol de los servidores de ficheros de Microsoft que permite definir acciones y ejecutar scripts frente a la escritura de ciertos tipos de ficheros.